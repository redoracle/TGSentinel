{% extends "base.html" %}
{% block title %}API Documentation · TG Sentinel{% endblock %}

{% block extra_head %}
<!-- Highlight.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" integrity="sha512-rO+olRTkcf304DQBxSWxln8JXCzTHlKnIdnMUwYvQa9/Jd4cQaNkItIUj6Z4nvW1dqK0SKXLbn9h4KwZTNtAyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block body_attrs %} class="docs-page"{% endblock %}

{% block content %}
<section class="card docs-wrapper">
    <div class="card-header">
        <h1 class="card-title mb-0">Documentation Sets</h1>
        <small class="text-muted">Switch between Sentinel API, UI API, YAML configuration, and User Manual</small>
    </div>
    <div class="p-1 docs-tabs-shell">
        <ul class="nav nav-tabs nav-fill border-bottom-0" id="docsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="sentinel-docs-tab" type="button" data-docs-tab-button="sentinel" role="tab" aria-controls="sentinel-docs" aria-selected="true">
                    Sentinel API Documentation
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ui-docs-tab" type="button" data-docs-tab-button="ui" role="tab" aria-controls="ui-docs" aria-selected="false">
                    UI API Documentation
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="yaml-docs-tab" type="button" data-docs-tab-button="yaml" role="tab" aria-controls="yaml-docs" aria-selected="false">
                    Sentinel YAML Configuration Documentation
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="manual-docs-tab" type="button" data-docs-tab-button="manual" role="tab" aria-controls="manual-docs" aria-selected="false">
                    User Manual
                </button>
            </li>
        </ul>
    </div>
    <div class="docs-layout p-1">
        <div class="row g-0 g-lg-3 flex-grow-1">
            <div class="col-12 col-lg-3 docs-nav-column mb-4 mb-lg-0">
                <div class="card sticky-nav">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Navigation</h5>
                    </div>
                    <div class="card-body">
                        <div class="docs-nav-list active" data-docs-nav="sentinel">
                            <nav class="nav flex-column nav-pills" aria-label="Sentinel API navigation">
                                <a class="nav-link active" href="#sentinel-overview">Overview</a>
                                <a class="nav-link" href="#sentinel-config">Config Management</a>
                                <a class="nav-link" href="#sentinel-session">Session Management</a>
                                <a class="nav-link" href="#sentinel-status">Health & Status</a>
                                <a class="nav-link" href="#sentinel-database">Database Operations</a>
                                <a class="nav-link" href="#sentinel-assets">Media & Stats</a>
                            </nav>
                        </div>
                        <div class="docs-nav-list" data-docs-nav="ui">
                            <nav class="nav flex-column nav-pills" aria-label="UI API navigation">
                                <a class="nav-link active" href="#overview" aria-current="page">Overview</a>
                                <a class="nav-link" href="#authentication">Authentication</a>
                                <a class="nav-link" href="#session-login">Session Login</a>
                                <a class="nav-link" href="#ui-lock">UI Lock</a>
                                <a class="nav-link" href="#dashboard">Dashboard</a>
                                <a class="nav-link" href="#alerts">Alerts</a>
                                <a class="nav-link" href="#config">Configuration</a>
                                <a class="nav-link" href="#analytics">Analytics</a>
                                <a class="nav-link" href="#telegram">Telegram</a>
                                <a class="nav-link" href="#webhooks">Webhooks</a>
                                <a class="nav-link" href="#system">System</a>
                                <a class="nav-link" href="#examples">Examples</a>
                                <a class="nav-link" href="#tools">Tools</a>
                            </nav>
                        </div>
                        <div class="docs-nav-list" data-docs-nav="yaml">
                            <nav class="nav flex-column nav-pills" aria-label="YAML configuration navigation">
                                <a class="nav-link active" href="#yaml-overview">Overview</a>
                                <a class="nav-link" href="#yaml-tgsentinel">tgsentinel.yml</a>
                                <a class="nav-link" href="#yaml-developer">developer.yml</a>
                                <a class="nav-link" href="#yaml-webhooks">webhooks.yml</a>
                                <a class="nav-link" href="#yaml-volumes">Docker Volumes</a>
                            </nav>
                        </div>
                        <div class="docs-nav-list" data-docs-nav="manual">
                            <nav class="nav flex-column nav-pills" aria-label="User manual navigation">
                                <a class="nav-link active" href="#manual-overview">Overview</a>
                                <a class="nav-link" href="#manual-getting-started">Getting Started</a>
                                <a class="nav-link" href="#manual-profiles">Profile Management</a>
                                <a class="nav-link ms-3" href="#alert-profiles">Alert Profiles</a>
                                <a class="nav-link ms-3" href="#interest-profiles">Interest Profiles</a>
                                <a class="nav-link ms-3" href="#detection-settings">Detection Settings</a>
                                <a class="nav-link ms-3" href="#profile-scope">Profile Scope</a>
                                <a class="nav-link ms-3" href="#digest-api">Digest Schedules</a>
                                <a class="nav-link" href="#alerts-api">Alerts & Notifications</a>
                                <a class="nav-link" href="#configuration">Configuration/Settings</a>
                                <a class="nav-link ms-3" href="#telegram-config">Telegram Settings</a>
                                <a class="nav-link ms-3" href="#alerts-config">Alert Configuration</a>
                                <a class="nav-link ms-3" href="#advanced-config">Advanced Settings</a>
                                <a class="nav-link ms-3" href="#channels-api">Channels Management</a>
                                <a class="nav-link ms-3" href="#users-api">Users Management</a>
                                <a class="nav-link ms-3" href="#system-config">System Settings</a>
                                <a class="nav-link" href="#analytics">Analytics & Insights</a>
                                <a class="nav-link ms-3" href="#performance-metrics">Performance Metrics</a>
                                <a class="nav-link ms-3" href="#resource-metrics">Resource Monitoring</a>
                                <a class="nav-link ms-3" href="#keyword-heatmap">Keyword Heatmap</a>
                                <a class="nav-link ms-3" href="#channel-impact">Channel Impact</a>
                                <a class="nav-link" href="#developer">Developer & Integrations</a>
                                <a class="nav-link ms-3" href="#integration-settings">Integration Settings</a>
                                <a class="nav-link ms-3" href="#webhooks-api">Webhooks</a>
                                <a class="nav-link ms-3" href="#integration-console">Integration Console</a>
                                <a class="nav-link" href="#console">Console & Maintenance</a>
                                <a class="nav-link ms-3" href="#console-logs">Log Viewer</a>
                                <a class="nav-link ms-3" href="#console-commands">System Commands</a>
                                <a class="nav-link ms-3" href="#maintenance">Maintenance Tools</a>
                                <a class="nav-link ms-3" href="#diagnostics">Diagnostics</a>
                                <a class="nav-link" href="#manual-troubleshooting">Troubleshooting</a>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-9 docs-content">
        <div class="docs-tab-pane active" data-docs-content="sentinel" id="sentinel-docs">
            <section id="sentinel-overview" class="mb-5">
                <h1 class="section-header">Sentinel API Overview</h1>
                <p class="lead">Worker-level HTTP API exposed only inside the Docker network. Use it for health checks, session lifecycle events, and telemetry shared with the UI.</p>
                <div class="alert alert-info">
                    <strong>Base URL:</strong> <code>{{ sentinel_api_base_url | default('http://localhost:8080') }}</code><br>
                    <strong>Service:</strong> <code>sentinel</code> container (Telethon owner).<br>
                    <strong>Security:</strong> Never expose publicly; UI proxies the required flows.
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle">
                        <thead>
                            <tr>
                                <th>Method</th>
                                <th>Endpoint</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/metrics</code></td>
                                <td>Prometheus metrics endpoint for monitoring and alerting.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/health</code></td>
                                <td>Heartbeat with timestamp for readiness probes.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/status</code></td>
                                <td>Authorization flag, connection status, cached user_info, last_sync.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/config</code></td>
                                <td>Get current configuration (single source of truth).</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-post">POST</span></td>
                                <td><code>/api/config</code></td>
                                <td>Update configuration with deep merge (writes to YAML).</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-post">POST</span></td>
                                <td><code>/api/session/import</code></td>
                                <td>Atomic Telethon session upload (JSON base64 or multipart).</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-post">POST</span></td>
                                <td><code>/api/session/logout</code></td>
                                <td>Removes <code>*.session*</code> artifacts and publishes logout event.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/avatar/&lt;prefix&gt;/&lt;int:entity_id&gt;</code></td>
                                <td>Streams JPEG avatar from Redis cache for users/chats.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/alerts</code></td>
                                <td>Placeholder alert feed (extend within sentinel handlers).</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/digests</code></td>
                                <td>Returns recent message digests with metadata.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-post">POST</span></td>
                                <td><code>/api/feedback</code></td>
                                <td>Submit user feedback (thumbs up/down) for alert quality.</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-get">GET</span></td>
                                <td><code>/api/stats</code></td>
                                <td>Placeholder metrics (messages_processed, alerts_sent, uptime_seconds).</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-post">POST</span></td>
                                <td><code>/api/database/vacuum</code></td>
                                <td>Optimize database by reclaiming unused space (SQLite VACUUM).</td>
                            </tr>
                            <tr>
                                <td><span class="method-badge method-post">POST</span></td>
                                <td><code>/api/database/cleanup</code></td>
                                <td>Delete old messages based on retention policy.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="sentinel-config" class="mb-5">
                <h2 class="section-header">Config Management (Single Source of Truth)</h2>
                <p>Sentinel is the authoritative owner of <code>config/tgsentinel.yml</code>. The UI proxies all configuration operations through these endpoints.</p>
                
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/config</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Returns the complete configuration including telegram settings, alerts, digest, channels, monitored_users, interests, and system settings.</p>
                        <h6>Response Example:</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "data": {
    "telegram": {
      "session": "data/tgsentinel.session"
    },
    "alerts": {
      "mode": "both",
      "target_channel": "@alerts"
    },
    "digest": {
      "hourly": true,
      "daily": false,
      "top_n": 10
    },
    "channels": [
      {
        "id": -1001193248583,
        "name": "marketing Announcements",
        "vip_senders": [],
        "keywords": ["marketing", "upgrade"],
        "reaction_threshold": 3,
        "reply_threshold": 2,
        "rate_limit_per_hour": 10
      }
    ],
    "monitored_users": [
      {
        "id": 789012,
        "name": "Test User",
        "username": "testuser",
        "enabled": true
      }
    ],
    "interests": ["security", "vulnerability"],
    "redis": "redis://redis:6379/0",
    "database_uri": "sqlite:////app/data/sentinel.db",
    "embeddings_model": "all-MiniLM-L6-v2",
    "similarity_threshold": 0.42
  },
  "error": null
}</code></pre>
                    </div>
                </div>

                <div class="endpoint-card card method-post">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                                <strong class="ms-2 section-url">/api/config</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Updates configuration via deep merge. Writes to <code>config/tgsentinel.yml</code> and reloads global config. UI uses this for all config mutations (channels, users, settings).</p>
                        <h6>Request Body Example (updating monitored users):</h6>
                        <pre class="code-block"><code class="language-json">{
  "monitored_users": [
    {
      "id": 123456,
      "name": "Alice",
      "username": "alice",
      "enabled": true
    }
  ]
}</code></pre>
                        <h6>Response:</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Configuration updated",
  "error": null
}</code></pre>
                        <h6>Usage Pattern:</h6>
                        <pre class="code-block"><code class="language-bash"># Fetch current config
curl {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/config

# Update specific section (deep merge)
curl -X POST {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/config \
  -H "Content-Type: application/json" \
  -d '{"channels": [{"id": -100123, "name": "New Channel"}]}'</code></pre>
                    </div>
                </div>
            </section>

            <section id="sentinel-session" class="mb-5">
                <h2 class="section-header">Session Management</h2>
                <p>Upload and reset Telethon sessions exclusively through these worker endpoints.</p>
                <div class="endpoint-card card method-post">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                                <strong class="ms-2 section-url">/api/session/import</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Accepts <code>{"session_data":"base64"}</code> JSON or multipart <code>session_file</code>. Validates Telethon schema, removes stale WAL files, writes to <code>{{ _config.telegram_session if _config else 'data/tgsentinel.session' }}</code>, then publishes <code>tgsentinel:session_updated</code>.</p>
                        <h6>cURL example:</h6>
                        <pre class="code-block"><code class="language-bash">curl -X POST {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/session/import \
  -F "session_file=@tgsentinel.session"</code></pre>
                    </div>
                </div>
                <div class="endpoint-card card method-post">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                                <strong class="ms-2 section-url">/api/session/logout</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Removes every <code>/app/data/*.session*</code> file and announces a logout event for the session monitor.</p>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Logout successful",
  "files_removed": [
    "/app/data/tgsentinel.session",
    "/app/data/tgsentinel.session-wal"
  ]
}</code></pre>
                    </div>
                </div>
            </section>

            <section id="sentinel-status" class="mb-5">
                <h2 class="section-header">Health & Status</h2>
                <p>Feed UI worker badges and external monitors.</p>
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/health</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Returns <code>{"status":"ok","service":"tgsentinel","timestamp":"..."}</code>. Safe for Kubernetes-style probes.</p>
                    </div>
                </div>
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/status</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Primary status document consumed by the UI.</p>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "data": {
    "authorized": true,
    "connected": true,
    "user_info": {"username": "Analyst"},
    "last_sync": "2025-11-18T12:47:39Z"
  },
  "error": null
}</code></pre>
                    </div>
                </div>
            </section>

            <section id="sentinel-database" class="mb-5">
                <h2 class="section-header">Database Operations</h2>
                <p>Database maintenance endpoints for optimizing storage and cleaning up old message data. These operations affect <code>sentinel.db</code> only.</p>
                
                <div class="endpoint-card card method-post">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                                <strong class="ms-2 section-url">/api/database/vacuum</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Runs SQLite VACUUM on <code>sentinel.db</code> to reclaim unused space and optimize database file structure. This operation rebuilds the database file and can take time proportional to database size.</p>
                        <h6>Request Body:</h6>
                        <pre class="code-block"><code class="language-json">{}</code></pre>
                        <h6 class="alert alert-info">Response Example (Success):</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "VACUUM completed",
  "details": {
    "size_before_mb": 125.4,
    "size_after_mb": 98.2,
    "space_freed_mb": 27.2
  }
}</code></pre>
                        <h6>Usage Pattern:</h6>
                        <pre class="code-block"><code class="language-bash">curl -X POST {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/database/vacuum \
  -H "Content-Type: application/json" \
  -d '{}'</code></pre>
                        <div class="alert alert-warning mt-3">
                            <strong>Note:</strong> VACUUM requires exclusive database access and may take several seconds to minutes on large databases. Run during maintenance windows.
                        </div>
                    </div>
                </div>

                <div class="endpoint-card card method-post">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                                <strong class="ms-2 section-url">/api/database/cleanup</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Deletes old message records from <code>sentinel.db</code> based on retention policy. Removes messages older than the configured retention period while preserving recent data for analysis.</p>
                        <h6>Request Body (Optional - uses defaults from config):</h6>
                        <pre class="code-block"><code class="language-json">{
  "retention_days": 90
}</code></pre>
                        <h6 class="alert alert-info">Response Example (Success):</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Cleanup completed",
  "details": {
    "messages_deleted": 15420,
    "retention_days": 90,
    "oldest_remaining": "2024-08-19T00:00:00Z"
  }
}</code></pre>
                        <h6>Usage Pattern:</h6>
                        <pre class="code-block"><code class="language-bash"># Use default retention period
curl -X POST {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/database/cleanup \
  -H "Content-Type: application/json" \
  -d '{}'

# Specify custom retention period (30 days)
curl -X POST {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/database/cleanup \
  -H "Content-Type: application/json" \
  -d '{"retention_days": 30}'</code></pre>
                        <div class="alert alert-info mt-3">
                            <strong>Tip:</strong> Run cleanup before VACUUM for maximum space reclamation. Typical workflow: cleanup (delete old data) → vacuum (reclaim space).
                        </div>
                    </div>
                </div>
            </section>

            <section id="sentinel-assets" class="mb-5">
                <h2 class="section-header">Media & Metrics</h2>
                <p>Supporting endpoints for avatars, monitoring metrics, digests, and user feedback. Extend within <code>src/tgsentinel/api.py</code> as needed.</p>
                
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/metrics</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Prometheus-compatible metrics endpoint exposing Sentinel worker statistics. Designed for monitoring tools like Prometheus, Grafana, or DataDog.</p>
                        <h6>Response Format:</h6>
                        <pre class="code-block"><code class="language-plain"># HELP tgsentinel_messages_ingested_total Total number of messages ingested
# TYPE tgsentinel_messages_ingested_total counter
tgsentinel_messages_ingested_total 12450

# HELP tgsentinel_alerts_sent_total Total number of alerts sent
# TYPE tgsentinel_alerts_sent_total counter
tgsentinel_alerts_sent_total 342

# HELP tgsentinel_worker_uptime_seconds Worker uptime in seconds
# TYPE tgsentinel_worker_uptime_seconds gauge
tgsentinel_worker_uptime_seconds 86400.5

# HELP tgsentinel_connection_status Connection status (1=connected, 0=disconnected)
# TYPE tgsentinel_connection_status gauge
tgsentinel_connection_status 1</code></pre>
                        <h6>Usage Pattern:</h6>
                        <pre class="code-block"><code class="language-bash"># Scrape metrics manually
curl {{ sentinel_api_base_url | default('http://localhost:8080') }}/metrics

# Prometheus scrape configuration
scrape_configs:
  - job_name: 'tgsentinel'
    static_configs:
      - targets: ['sentinel:8080']</code></pre>
                    </div>
                </div>
                
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/avatar/&lt;prefix&gt;/&lt;entity_id&gt;</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Use <code>prefix=user|chat</code>. Returns JPEG bytes cached in Redis (<code>tgsentinel:user_avatar:&lt;id&gt;</code>).</p>
                        <h6>URL Parameters:</h6>
                        <ul>
                            <li><code>prefix</code>: <code>user</code> or <code>chat</code></li>
                            <li><code>entity_id</code>: Telegram entity ID (integer)</li>
                        </ul>
                        <h6>Example:</h6>
                        <pre class="code-block"><code class="language-bash"># Get user avatar
curl {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/avatar/user/123456789 -o avatar.jpg

# Get chat avatar
curl {{ sentinel_api_base_url | default('http://localhost:8080') }}/api/avatar/chat/1001234567890 -o chat_avatar.jpg</code></pre>
                    </div>
                </div>
                
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/alerts</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Returns recent alerts generated by the Sentinel worker. Currently returns placeholder data; extend for production use.</p>
                        <h6 class="alert alert-info">Response Example:</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "data": {
    "alerts": []
  },
  "error": null
}</code></pre>
                    </div>
                </div>
                
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/digests</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Returns recent digest summaries with metadata including timestamp, item count, and average importance scores.</p>
                        <h6 class="alert alert-info">Response Example:</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "data": {
    "digests": [
      {
        "timestamp": "2025-11-18T12:00:00Z",
        "type": "hourly",
        "items": 42,
        "avg_importance": 0.67,
        "top_channels": ["Channel Alpha", "Channel Beta"]
      }
    ]
  },
  "error": null
}</code></pre>
                    </div>
                </div>
                
                <div class="endpoint-card card method-post">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                                <strong class="ms-2 section-url">/api/feedback</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Submit user feedback (thumbs up/down) for alert quality. Used to improve heuristics and scoring algorithms over time.</p>
                        <h6>Request Body:</h6>
                        <pre class="code-block"><code class="language-json">{
  "chat_id": -1001234567890,
  "msg_id": 12345,
  "label": "up"
}</code></pre>
                        <h6>Parameters:</h6>
                        <ul>
                            <li><code>chat_id</code>: Telegram chat ID (negative for groups/channels)</li>
                            <li><code>msg_id</code>: Message ID within the chat</li>
                            <li><code>label</code>: <code>"up"</code> (thumbs up) or <code>"down"</code> (thumbs down)</li>
                        </ul>
                        <h6 class="alert alert-info">Response:</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Feedback recorded",
  "error": null
}</code></pre>
                    </div>
                </div>
                
                <div class="endpoint-card card method-get">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                                <strong class="ms-2 section-url">/api/stats</strong>
                            </div>
                        </div>
                        <p class="mb-2 alert-info">Returns worker operational statistics including message counts, alert counts, and uptime. Use this for dashboards and status pages.</p>
                        <h6 class="alert alert-info">Response Example:</h6>
                        <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "data": {
    "messages_processed": 15240,
    "alerts_sent": 432,
    "uptime_seconds": 86400.5,
    "last_message_at": "2025-11-18T12:45:00Z",
    "connected_chats": 8
  },
  "error": null
}</code></pre>
                    </div>
                </div>
            </section>
        </div>

        <div class="docs-tab-pane" data-docs-content="ui" id="ui-docs">
        <!-- Overview -->
        <section id="overview" class="mb-5">
            <h1 class="section-header">TG Sentinel API Documentation</h1>
            <p class="lead">Complete REST API reference for TG Sentinel monitoring and alerting system.</p>
            
            <div class="alert alert-info">
                <strong>Base URL:</strong> <code>{{ api_base_url }}</code><br>
                <strong>API Version:</strong> v1<br>
                <strong>Response Format:</strong> JSON
            </div>

            <h3>Quick Start</h3>
            <p>All API endpoints return JSON responses. Most endpoints require the application to be initialized.</p>
            <pre class="code-block"><code class="language-bash">
curl -X GET {{ api_base_url }}/api/system/health \
  -H "Content-Type: application/json"
            </code></pre>
        </section>

        <!-- Authentication -->
        <section id="authentication" class="mb-5">
            <h2 class="section-header">Authentication</h2>
            <p>Currently, API authentication is handled via session cookies. API key authentication is planned for future releases.</p>
            
            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/session/info</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get current session information including username, connection status, and connected chats.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "username": "Analyst",
  "avatar": "/static/images/logo.png",
  "session_path": "data/tgsentinel.session",
  "phone_masked": "+1***1234",
  "connected": true,
  "connected_chats": ["Channel Alpha", "Channel Beta"]
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/alerts/feedback</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Record thumbs up/down feedback for an alert (improves heuristics).</p>
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{
  "chat_id": -1001234567890,
  "msg_id": 12345,
  "label": "up" // or "down"
}</code></pre>
                    <h6 class="alert alert-info">Response:</h6>
                    <pre class="code-block"><code class="language-json">{"status": "ok"}</code></pre>
                </div>
            </div>
        </section>

        <!-- Session Login -->
        <section id="session-login" class="mb-5">
            <h2 class="section-header">Session Login</h2>
            <p>Endpoints to start and verify interactive MTProto login from the UI. These endpoints are designed for user-initiated flows, not long‑lived programmatic tokens.</p>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/session/login/start</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Send a login confirmation code to the specified phone number. Normalizes phone and stores a short‑lived login context.</p>
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{
  "phone": "+41 2600 0000"
}</code></pre>
                    <h6 class="alert alert-info">Response:</h6>
                    <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Code sent"
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/session/login/verify</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Verify the received code and finalize login. Supports 2FA password when required.</p>
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{
  "phone": "+41 2600 0000",
  "code": "12345",
  "password": "optional-2fa-password"
}</code></pre>
                    <h6 class="alert alert-info">Responses:</h6>
                    <pre class="code-block"><code class="language-json">// 200 OK
{
  "status": "ok",
  "message": "Authenticated",
  "redirect": "/alerts"
}

// 410 Gone (context expired or missing)
{
  "status": "error",
  "message": "Login session expired or missing. Please click 'Send Code' again."
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/session/relogin</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Clears the current session and returns a hint to start the re‑authentication flow.</p>
                    <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Session cleared. Start re-authentication.",
  "relogin_required": true,
  "redirect": "/alerts"
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/session/logout</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Invalidates the local Telethon session and clears cached user data.</p>
                    <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "message": "Session cleared. You may re-login.",
  "details": {"file_removed": true},
  "redirect": "/alerts"
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/config/channels/add</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Add one or more channels to the config (id + name). Skips duplicates.</p>
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{
  "channels": [
    {"id": -1001111111111, "name": "Broadcast Channel"},
    {"id": -1002222222222, "name": "Supergroup"}
  ]
}</code></pre>
                    <h6 class="alert alert-info">Response:</h6>
                    <pre class="code-block"><code class="language-json">{"status": "ok", "added": 2}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-delete">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-delete" aria-label="HTTP DELETE method">DELETE</span>
                            <strong class="ms-2 section-url">/api/config/channels/&lt;chat_id&gt;</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Delete a channel by ID.</p>
                    <pre class="code-block"><code class="language-bash">curl -X DELETE {{ api_base_url }}/api/config/channels/-1001111111111</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/config/users/add</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Add monitored users to the config.</p>
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{
  "users": [
    {"id": 555555, "name": "User 1", "username": "u1"},
    {"id": 666666, "name": "User 2", "username": "u2"}
  ]
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-delete">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-delete" aria-label="HTTP DELETE method">DELETE</span>
                            <strong class="ms-2 section-url">/api/config/users/&lt;user_id&gt;</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Delete a monitored user by ID.</p>
                    <pre class="code-block"><code class="language-bash">curl -X DELETE {{ api_base_url }}/api/config/users/555555</code></pre>
                </div>
            </div>
        </section>

        <!-- UI Lock -->
        <section id="ui-lock" class="mb-5">
            <h2 class="section-header">UI Lock</h2>
            <p>Lock the UI without logging out of Telegram. Unlock with a password (optional).</p>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/ui/lock</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Lock or unlock the UI. Requires JSON body.</p>
                    <h6>Lock Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{"action": "lock"}</code></pre>
                    <h6>Unlock Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{"action": "unlock", "password": "your-password"}</code></pre>
                    <h6 class="alert alert-info">Responses:</h6>
                    <pre class="code-block"><code class="language-json">// 200 OK
{"status":"ok","locked":true}

// 403 when password mismatches
{"status":"error","message":"Invalid password"}

// 423 for locked API routes (except /api/ui/lock and /api/session/*)
{"status":"locked","message":"UI locked"}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/ui/lock/status</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get current lock status and configuration hints.</p>
                    <pre class="code-block"><code class="language-json">{
  "locked": false,
  "timeout": 900,
  "enabled": true
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="mb-5">
            <h2 class="section-header">Dashboard</h2>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/dashboard/summary</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get dashboard summary statistics for the last 24 hours.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "messages_ingested": 1250,
  "alerts_sent": 45,
  "avg_importance": 0.67,
  "feedback_accuracy": 87.5
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/dashboard/activity</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get live activity feed from Redis stream.</p>
                    
                    <h6 class="alert alert-info">Query Parameters:</h6>
                    <table class="table table-sm param-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Default</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>limit</code></td>
                                <td>integer</td>
                                <td>20</td>
                                <td>Maximum number of entries (max: 100)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "entries": [
    {
      "id": "1699876543210-0",
      "chat_name": "marketing Dev",
      "sender": "Alice",
      "message": "New smart contract deployed...",
      "importance": 0.85,
      "tags": ["smart-contract", "deployment"],
      "timestamp": "2025-11-12T10:30:00Z"
    }
  ]
}
                    </code></pre>
                </div>
            </div>
        </section>

        <!-- Alerts -->
        <section id="alerts" class="mb-5">
            <h2 class="section-header">Alerts</h2>

            <div id="alerts-api" class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/alerts/recent</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get recent alerts ordered by creation time (descending).</p>
                    
                    <h6 class="alert alert-info">Query Parameters:</h6>
                    <table class="table table-sm param-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Default</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>limit</code></td>
                                <td>integer</td>
                                <td>100</td>
                                <td>Maximum number of alerts (max: 250)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "alerts": [
    {
      "chat_id": -1001234567890,
      "chat_name": "Crypto Alerts",
      "sender": "Bob",
      "excerpt": "Important security update...",
      "score": 0.92,
      "trigger": "Importance threshold",
      "sent_to": "both",
      "created_at": "2025-11-12T09:15:00"
    }
  ]
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/alerts/digests</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get digest summaries grouped by date.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "digests": [
    {
      "date": "2025-11-12",
      "items": 15,
      "avg_score": 0.78
    },
    {
      "date": "2025-11-11",
      "items": 23,
      "avg_score": 0.82
    }
  ]
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/export_alerts</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Export alerts as CSV. When data is present, headers are machine-friendly for CSV parsers.</p>
                    <pre class="code-block"><code class="language-bash">curl -L {{ api_base_url }}/api/export_alerts?limit=500 -o alerts.csv</code></pre>
                </div>
            </div>
        </section>

        <!-- Configuration -->
        <section id="config" class="mb-5">
            <h2 class="section-header">Configuration</h2>
            <p>TG Sentinel configuration includes separate management for <strong>Monitored Channels</strong> (channels/supergroups) and <strong>Monitored Users</strong> (individual private chats). Both sections have independent add/delete operations and can be configured via the <code>/config</code> page.</p>

            <div id="telegram-config" class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/config/current</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get current configuration including environment variables (Telegram settings, alerts mode, digest settings, etc.).</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "telegram": {
    "api_id": "12345678",
    "api_hash": "abcd1234...",
    "phone_number": "+1234567890",
    "session": "data/tgsentinel.session"
  },
  "alerts": {
    "mode": "both",
    "target_channel": "@my_alerts"
  },
  "digest": {
    "hourly": true,
    "daily": false,
    "top_n": 10
  },
  "redis": {
    "host": "redis",
    "port": 6379
  },
  "semantic": {
    "embeddings_model": "all-MiniLM-L6-v2",
    "similarity_threshold": 0.42
  },
  "database_uri": "sqlite:///data/sentinel.db"
}
                    </code></pre>
                </div>
            </div>

            <div id="scoring-config" class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/config/save</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Save configuration changes to YAML file (includes Telegram settings, alerts mode, digest settings, and scoring/semantic thresholds).</p>
                    
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "phone_number": "+1234567890",
  "mode": "both",
  "target_channel": "@alerts",
  "digest": {
    "hourly": true,
    "daily": false,
    "top_n": 10
  }
}
                    </code></pre>

                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "status": "ok"
}
                    </code></pre>
                </div>
            </div>

            <div id="channels-api" class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/config/channels</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get list of configured Telegram channels (monitored channels section).</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "channels": [
    {
      "id": -1001234567890,
      "chat_id": -1001234567890,
      "name": "marketing Official",
      "vip_senders": [111111, 222222],
      "keywords": ["governance", "update"],
      "reaction_threshold": 5,
      "reply_threshold": 3,
      "enabled": true
    }
  ]
}
                    </code></pre>
                </div>
            </div>

            <div id="users-api" class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/config/users</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get list of configured monitored users (monitored users section, separate from channels).</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "users": [
    {
      "id": 555555,
      "name": "John Doe",
      "username": "johndoe",
      "enabled": true
    },
    {
      "id": 666666,
      "name": "Jane Smith",
      "username": "janesmith",
      "enabled": false
    }
  ]
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/sentinel/restart</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Restart the sentinel container to apply configuration changes.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "status": "ok",
  "message": "Sentinel restarting"
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/config/rules/test</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Run a lightweight rules test for configured channels (diagnostics only).</p>
                    <h6>Request Body (optional):</h6>
                    <pre class="code-block"><code class="language-json">{
  "channel_ids": [-1001234567890],
  "text": "sample text"
}</code></pre>
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "tested": 1,
  "results": [
    {
      "channel_id": -1001234567890,
      "channel_name": "Example",
      "matched_rules": ["keyword"],
      "diagnostics": {
        "keywords": ["keyword"],
        "vip_senders": [],
        "reaction_threshold": 5,
        "reply_threshold": 3
      }
    }
  ]
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/config/stats/reset</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Reset transient per‑channel counters (best‑effort).</p>
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">{
  "status": "ok",
  "cleared_keys": 3
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/config/export</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Download the current YAML configuration.</p>
                    <h6 class="alert alert-info">Response:</h6>
                    <pre class="code-block"><code class="language-bash">curl -OJ {{ api_base_url }}/api/config/export</code></pre>
                </div>
            </div>
        </section>

        <!-- Analytics -->
        <section id="analytics" class="mb-5">
            <h2 class="section-header">Analytics</h2>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/analytics/metrics</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get real-time system and processing metrics.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "messages_per_min": 12.5,
  "semantic_latency": 45,
  "cpu": 23.4,
  "memory": 512.3,
  "redis_stream_depth": 156
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/analytics/keywords</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get top keywords and their frequency.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "keywords": [
    {"keyword": "governance", "count": 45},
    {"keyword": "security", "count": 32},
    {"keyword": "update", "count": 28}
  ]
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/analytics/anomalies</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Detect anomalies in message volume and patterns.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "anomalies": [
    {
      "type": "volume_spike",
      "severity": "high",
      "description": "Message volume 3x above baseline",
      "timestamp": "2025-11-12T10:00:00Z",
      "affected_channels": ["Crypto News"]
    }
  ]
}
                    </code></pre>
                </div>
            </div>
        </section>

        <!-- Console -->
        <section id="console" class="mb-5">
            <h2 class="section-header">Console</h2>
            <p>Administrative console actions and diagnostics export.</p>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/console/command</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Accepts simple commands (e.g., "reauth"). Returns accepted status.</p>
                    <pre class="code-block"><code class="language-json">{
  "command": "reauth"
}</code></pre>
                    
                    <h6 class="alert alert-info">Response:</h6>
                    <pre class="code-block"><code class="language-json">{
  "status": "accepted",
  "message": "Command queued"
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/console/diagnostics</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Exports anonymized diagnostics bundle (JSON attachment).</p>
                    <pre class="code-block"><code class="language-bash">curl -L {{ api_base_url }}/api/console/diagnostics -o diagnostics.json</code></pre>
                </div>
            </div>
        </section>

        <!-- Developer -->
        <section id="developer" class="mb-5">
            <h2 class="section-header">Developer</h2>
            <p>Integration settings for Prometheus metrics and local API docs.</p>
            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/developer/settings</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Persist developer settings like Prometheus port and an ephemeral API key.</p>
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">{
  "prometheus_port": 9100,
  "api_key": "(optional)"
}</code></pre>
                    <h6 class="alert alert-info">Response:</h6>
                    <pre class="code-block"><code class="language-json">{"status": "ok"}</code></pre>
                </div>
            </div>
        </section>

        <!-- Telegram -->
        <section id="telegram" class="mb-5">
            <h2 class="section-header">Telegram</h2>
            <p>Direct MTProto access endpoints used by the UI for channel/user discovery.</p>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/telegram/chats</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">List accessible chats (channels/supergroups). Requires env TG_API_ID/TG_API_HASH and a valid session file.</p>
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">{
  "chats": [
    {"id": -100123, "name": "Channel A", "type": "channel", "username": null},
    {"id": -100456, "name": "Supergroup B", "type": "supergroup", "username": "groupb"}
  ]
}</code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/telegram/users</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Fetch private chats (users) via a cache+request pattern to the sentinel worker. Returns 200 with cached or fallback data; 503 when Redis is explicitly unavailable.</p>
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">{
  "users": [
    {"id": 111111, "name": "Cached User", "username": "cached", "phone": null}
  ]
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Webhooks -->
        <section id="webhooks" class="mb-5">
            <h2 class="section-header">Webhooks</h2>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/webhooks</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">List all configured webhooks (secrets are masked).</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "webhooks": [
    {
      "service": "Pushover",
      "url": "https://api.pushover.net/1/messages.json",
      "secret": "••••••",
      "enabled": true
    }
  ]
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-post">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-post" aria-label="HTTP POST method">POST</span>
                            <strong class="ms-2 section-url">/api/webhooks</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Create a new webhook configuration.</p>
                    
                    <h6>Request Body:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "service": "Discord",
  "url": "https://discord.com/api/webhooks/123/abc",
  "secret": "optional-token"
}
                    </code></pre>

                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "status": "ok",
  "service": "Discord"
}
                    </code></pre>

                    <h6>Error Responses:</h6>
                    <ul>
                        <li><code>400</code> - Missing required fields</li>
                        <li><code>409</code> - Duplicate service name</li>
                    </ul>
                </div>
            </div>

            <div class="endpoint-card card method-delete">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-delete" aria-label="HTTP DELETE method">DELETE</span>
                            <strong class="ms-2 section-url">/api/webhooks/:service_name</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Delete a webhook by service name.</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "status": "ok",
  "deleted": "Discord"
}
                    </code></pre>
                </div>
            </div>
        </section>

        <!-- System -->
        <section id="system" class="mb-5">
            <h2 class="section-header">System</h2>

            <div id="system-config" class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/system/health</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Get system health metrics and connection status (Redis, database, CPU, memory).</p>
                    
                    <h6 class="alert alert-info">Response Example:</h6>
                    <pre class="code-block"><code class="language-json">
{
  "redis_stream_depth": 156,
  "database_size_mb": 12.5,
  "redis_online": true,
  "cpu_percent": 23.4,
  "memory_mb": 512.3,
  "last_checkpoint": "2025-11-12T10:30:00Z"
}
                    </code></pre>
                </div>
            </div>

            <div class="endpoint-card card method-get">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="method-badge method-get" aria-label="HTTP GET method">GET</span>
                            <strong class="ms-2 section-url">/api/participant/info</strong>
                        </div>
                    </div>
                    <p class="mb-2 alert-info">Return chat/user/participant details. Supports pending mode (202) with minimal info and re‑polling.</p>
                    <pre class="code-block"><code class="language-bash">curl "{{ api_base_url }}/api/participant/info?chat_id=-100123&user_id=42&pending=1"</code></pre>
                    
                    <p class="mt-3 mb-2"><strong>Example 200 response (success):</strong></p>
                    <pre class="code-block"><code class="language-json">{
  "chat_id": -100123,
  "chat_title": "Tech Discussion Group",
  "chat_type": "channel",
  "chat_username": "techdiscussion",
  "user_id": 42,
  "user_first_name": "John",
  "user_last_name": "Doe",
  "user_username": "johndoe",
  "user_phone": "+1234567890",
  "user_is_bot": false,
  "participant_status": "member",
  "participant_role": "user",
  "participant_joined_at": "2025-01-15T08:30:00Z",
  "participant_is_admin": false,
  "participant_is_creator": false,
  "participant_can_post": true,
  "created_at": "2025-11-14T10:00:00Z",
  "metadata": {
    "last_seen": "2025-11-14T09:55:00Z",
    "message_count": 127
  }
}</code></pre>
                    
                    <p class="mt-3 mb-2"><strong>Example 202 pending response (data not yet available):</strong></p>
                    <pre class="code-block"><code class="language-json">{
  "chat_id": -100123,
  "user_id": 42,
  "status": "pending",
  "message": "Participant information is being fetched. Please retry after a few seconds.",
  "retry_after": 5
}</code></pre>

                    <h6 class="alert alert-info mt-3">Error Responses:</h6>
                    <pre class="code-block"><code class="language-json">// 400 Bad Request (missing or invalid parameters)
{
  "status": "error",
  "message": "Missing required parameters",
  "details": "Both chat_id and user_id are required"
}

// 401 Unauthorized (authentication required)
{
  "status": "error",
  "message": "Authentication required",
  "details": "Please log in to access this endpoint"
}

// 404 Not Found (participant or chat not found)
{
  "status": "error",
  "message": "Participant not found",
  "details": "No participant record exists for the specified chat_id and user_id"
}

// 422 Unprocessable Entity (validation error)
{
  "status": "error",
  "message": "Invalid parameter value",
  "details": "chat_id must be a valid integer"
}

// 500 Internal Server Error
{
  "status": "error",
  "message": "Internal server error",
  "details": "An unexpected error occurred. Please try again later or contact support."
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Examples -->
        <section id="examples" class="mb-5">
            <h2 class="section-header">Code Examples</h2>

            <h3>Python</h3>
            <pre class="code-block"><code class="language-python">
import requests

# Get system health
response = requests.get('{{ api_base_url }}/api/system/health')
health = response.json()
print(f"Redis online: {health['redis_online']}")

# Create a webhook
webhook_data = {
    "service": "Slack",
    "url": "https://hooks.slack.com/services/T00/B00/XXX",
    "secret": "xoxb-token"
}
response = requests.post(
    '{{ api_base_url }}/api/webhooks',
    json=webhook_data
)
print(response.json())
            </code></pre>

            <h3>JavaScript/Node.js</h3>
            <pre class="code-block"><code class="language-javascript">
// Get recent alerts
fetch('{{ api_base_url }}/api/alerts/recent?limit=10')
  .then(response => response.json())
  .then(data => {
    console.log(`Found ${data.alerts.length} alerts`);
    data.alerts.forEach(alert => {
      console.log(`${alert.chat_name}: ${alert.excerpt}`);
    });
  });

// Save configuration
const config = {
  mode: "both",
  target_channel: "@my_alerts"
};

fetch('{{ api_base_url }}/api/config/save', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(config)
})
  .then(response => response.json())
  .then(data => console.log('Config saved:', data));
            </code></pre>

            <h3>cURL</h3>
            <pre class="code-block"><code class="language-bash">
# Get dashboard summary
curl -X GET {{ api_base_url }}/api/dashboard/summary

# Create webhook
curl -X POST {{ api_base_url }}/api/webhooks \
  -H "Content-Type: application/json" \
  -d '{
    "service": "Discord",
    "url": "https://discord.com/api/webhooks/123/abc"
  }'

# Delete webhook
curl -X DELETE {{ api_base_url }}/api/webhooks/Discord

# Get analytics metrics
curl -X GET {{ api_base_url }}/api/analytics/metrics
            </code></pre>
        </section>

        <!-- Tools -->
        <section id="tools" class="mb-5">
            <h2 class="section-header">Developer Tools</h2>
            <p class="lead">TG Sentinel includes utility scripts in the <code>./tools</code> directory for development, testing, session management, and maintenance tasks.</p>
            
            <div class="alert alert-info">
                <strong>Location:</strong> All tools are located in <code>./tools/</code> directory<br>
                <strong>Usage:</strong> Run from project root: <code>python tools/&lt;script_name&gt;.py</code><br>
                <strong>Documentation:</strong> Full reference in <code>./tools/README.md</code>
            </div>

            <!-- Session Management Tools -->
            <h3 class="mt-4">Session Management</h3>
            
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-key"></i> generate_session.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Generate a portable Telegram session file that can be uploaded to TG Sentinel UI for authentication without SMS codes.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash">python tools/generate_session.py --phone +1234567890</code></pre>
                    
                    <h5>Features</h5>
                    <ul>
                        <li>Interactive authentication flow (SMS code + optional 2FA)</li>
                        <li>Generates valid Telethon session files</li>
                        <li>Verifies session integrity before saving</li>
                        <li>Creates portable files that work across installations</li>
                        <li>No rate limit impact (uses your own credentials)</li>
                    </ul>
                    
                    <h5>Options</h5>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Option</th>
                                <th>Description</th>
                                <th>Default</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>--phone</code></td>
                                <td>Phone number in international format (required)</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><code>--output</code></td>
                                <td>Output path for session file</td>
                                <td><code>./tgsentinel_upload.session</code></td>
                            </tr>
                            <tr>
                                <td><code>--api-id</code></td>
                                <td>Telegram API ID</td>
                                <td><code>TG_API_ID</code> env var</td>
                            </tr>
                            <tr>
                                <td><code>--api-hash</code></td>
                                <td>Telegram API hash</td>
                                <td><code>TG_API_HASH</code> env var</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h5>Example Workflow</h5>
                    <pre class="code-block"><code class="language-bash"># 1. Generate session file
python tools/generate_session.py --phone +1234567890

# 2. Enter SMS code when prompted
# 3. Enter 2FA password if enabled
# 4. Session saved to: ./tgsentinel_upload.session

# 5. Upload to TG Sentinel:
#    - Open UI → Authenticate Telegram Session
#    - Click "Upload Session" tab
#    - Select the .session file
#    - Click "Upload & Restore"</code></pre>
                    
                    <h5>Benefits</h5>
                    <div class="row g-2">
                        <div class="col-md-6">
                            <div class="alert alert-success mb-0">
                                <i class="bi bi-check-circle"></i> Avoid SMS code rate limits
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success mb-0">
                                <i class="bi bi-check-circle"></i> Quick account switching
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success mb-0">
                                <i class="bi bi-check-circle"></i> Backup/restore capability
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success mb-0">
                                <i class="bi bi-check-circle"></i> Development/testing environments
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning mt-3">
                        <strong><i class="bi bi-shield-lock"></i> Security Notes:</strong>
                        <ul class="mb-0">
                            <li>Session files contain your authorization key</li>
                            <li>Keep them secure (treat like passwords)</li>
                            <li>Don't share or commit to version control</li>
                            <li>Add <code>*.session</code> to <code>.gitignore</code></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-speedometer2"></i> check_rate_limit.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Check current Telegram rate limit status for authentication operations.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash">python tools/check_rate_limit.py</code></pre>
                    
                    <h5>Output Information</h5>
                    <ul>
                        <li>Worker authorization status</li>
                        <li>Active rate limits per action (send_code, resend_code, sign_in)</li>
                        <li>Time remaining until rate limits expire</li>
                        <li>Redis TTL information</li>
                    </ul>
                    
                    <h5>Example Output</h5>
                    <pre class="code-block"><code class="language-bash">Worker Status:
  Authorized: True
  Status: authorized
  Timestamp: 2025-11-15 10:30:45

Rate Limits:
  send_code: 49585 seconds remaining (~13.8 hours)
    Expires: 2025-11-16 00:06:30

No other rate limits active</code></pre>
                </div>
            </div>

            <!-- Testing & Development Tools -->
            <h3 class="mt-4">Testing & Development</h3>
            
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-play-circle"></i> run_tests.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Run the full test suite with coverage reporting.</p>
                    <pre class="code-block"><code class="language-bash">python tools/run_tests.py</code></pre>
                    <p class="mb-0">Executes all unit tests, integration tests, and contract tests with detailed coverage metrics.</p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-database"></i> simulate_populate_history.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Populate Redis with historical messages from monitored channels.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash">python tools/simulate_populate_history.py [--limit 100] [--channel-id CHANNEL_ID]</code></pre>
                    
                    <h5>Description</h5>
                    <p>Fetches the latest messages from configured Telegram channels and populates Redis as if they were just received. Useful for testing the importance scoring, semantic analysis, and alert generation systems.</p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-inbox"></i> simulate_digest_from_history.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Simulate digest generation using historical messages that were populated into Redis.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash">python tools/simulate_digest_from_history.py [--hours 24] [--top-n 10] [--limit 500]</code></pre>
                    
                    <h5>Description</h5>
                    <p>Reads recent entries from the configured Redis stream, scores them with the same heuristics used by the worker (but without sending per-message alerts), writes important ones into the DB as alerted, and finally composes and sends a digest.</p>
                    
                    <h5>Typical Flow</h5>
                    <ol>
                        <li>Run <code>simulate_populate_history.py</code> to seed the Redis stream from Telegram history</li>
                        <li>Run this script to score + mark messages and send a digest</li>
                    </ol>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-envelope"></i> simulate_digest.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Test script to trigger digest delivery immediately with test messages.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash">python tools/simulate_digest.py</code></pre>
                    
                    <h5>Description</h5>
                    <p>Creates test messages in the database and immediately sends a digest. Useful for testing the digest delivery mechanism without waiting for real messages.</p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-chat-dots"></i> simulate_live_feed.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Simulate a live Telegram feed between two accounts.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash">python tools/simulate_live_feed.py \
    --session-a ./my_dutch.session \
    --session-b ./temp_test.session \
    --api-id 123456 \
    --api-hash abcdef0123456789abcdef0123456789 \
    --direction a-to-b \
    --interval 5 \
    --count 20</code></pre>
                    
                    <h5>Using a text file of messages</h5>
                    <pre class="code-block"><code class="language-bash">python tools/simulate_live_feed.py \
    --session-a ./helper.session \
    --session-b ./client.session \
    --messages-file ./messages.txt \
    --direction a-to-b \
    --interval 10</code></pre>
                    
                    <h5>Description</h5>
                    <p>Given two Telethon session files for two different Telegram accounts, this script will make one or both accounts send messages at a fixed interval. Useful for testing TG Sentinel's ingestion using real Telegram traffic.</p>
                    
                    <h5>Options</h5>
                    <ul>
                        <li><code>--session-a</code> / <code>--session-b</code>: Path to session files</li>
                        <li><code>--api-id</code> / <code>--api-hash</code>: Telegram API credentials (or use <code>TG_API_ID</code>/<code>TG_API_HASH</code> env vars)</li>
                        <li><code>--direction</code>: Message direction (<code>a-to-b</code>, <code>b-to-a</code>, or <code>both</code>)</li>
                        <li><code>--interval</code>: Seconds between messages</li>
                        <li><code>--count</code>: Number of messages to send</li>
                        <li><code>--messages-file</code>: Optional text file with messages (one per line)</li>
                    </ul>
                </div>
            </div>

            <!-- Code Quality Tools -->
            <h3 class="mt-4">Code Quality & Formatting</h3>
            
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-code-slash"></i> format.sh</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Format Python code using black and isort.</p>
                    <pre class="code-block"><code class="language-bash">bash tools/format.sh</code></pre>
                    <p class="mb-0">Automatically formats all Python files according to project standards.</p>
                </div>
            </div>

            <!-- Migration Tools -->
            <h3 class="mt-4">Migration & Maintenance</h3>
            
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-arrow-repeat"></i> migrate_profiles.py</h4>
                </div>
                <div class="card-body">
                    <p class="card-text">Migration script to convert old-style keywords to two-layer profiles.</p>
                    
                    <h5>Usage</h5>
                    <pre class="code-block"><code class="language-bash"># Dry run (preview changes)
python tools/migrate_profiles.py --config config/tgsentinel.yml --dry-run

# Apply changes
python tools/migrate_profiles.py --config config/tgsentinel.yml --apply</code></pre>
                    
                    <h5>What It Does</h5>
                    <ol>
                        <li>Analyzes existing keywords in all channels/users</li>
                        <li>Groups them into logical profiles (security, releases, opportunities, etc.)</li>
                        <li>Generates profiles.yml with global profiles</li>
                        <li>Updates tgsentinel.yml to bind profiles instead of duplicating keywords</li>
                        <li>Creates backups before making changes</li>
                    </ol>
                    
                    <p class="mb-0">Use when upgrading TG Sentinel versions that include profile schema changes.</p>
                </div>
            </div>

            <!-- Getting Started with Tools -->
            <h3 class="mt-4">Getting Started</h3>
            
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-info-circle"></i> Getting API Credentials</h4>
                </div>
                <div class="card-body">
                    <p>To use <code>generate_session.py</code>, you need Telegram API credentials:</p>
                    <ol>
                        <li>Go to <a href="https://my.telegram.org/apps" target="_blank" rel="noopener">https://my.telegram.org/apps</a></li>
                        <li>Log in with your phone number</li>
                        <li>Click "API development tools"</li>
                        <li>Create an app (or use existing)</li>
                        <li>Copy the <code>api_id</code> and <code>api_hash</code></li>
                    </ol>
                    
                    <h5>Set as environment variables:</h5>
                    <pre class="code-block"><code class="language-bash">export TG_API_ID=12345678
export TG_API_HASH=abcdef1234567890abcdef1234567890</code></pre>
                    
                    <h5>Or provide via command line:</h5>
                    <pre class="code-block"><code class="language-bash">python tools/generate_session.py \
  --phone +1234567890 \
  --api-id 12345678 \
  --api-hash abcdef1234567890abcdef1234567890</code></pre>
                </div>
            </div>

            <!-- Best Practices -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-lightbulb"></i> Tips & Best Practices</h4>
                </div>
                <div class="card-body">
                    <h5>Backup Your Session</h5>
                    <pre class="code-block"><code class="language-bash"># Generate and backup
python tools/generate_session.py --phone +1234567890 --output backup.session
cp backup.session ~/safe-location/</code></pre>
                    
                    <h5>Test Before Upload</h5>
                    <p>The script automatically verifies the session file after creation. Look for:</p>
                    <pre class="code-block"><code class="language-bash">✓ Session file is valid and can be uploaded to TG Sentinel</code></pre>
                    
                    <h5>Multiple Accounts</h5>
                    <pre class="code-block"><code class="language-bash"># Account 1
python tools/generate_session.py --phone +1111111111 --output account1.session

# Account 2
python tools/generate_session.py --phone +2222222222 --output account2.session</code></pre>
                    <p>Then upload whichever account you want to use in TG Sentinel.</p>
                    
                    <h5>Recommended Storage Location</h5>
                    <p>Store session files outside the repository:</p>
                    <pre class="code-block"><code class="language-bash">python tools/generate_session.py \
  --phone +1234567890 \
  --output ~/Documents/telegram_sessions/tgsentinel.session</code></pre>
                </div>
            </div>

            <!-- Troubleshooting -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="card-title mb-0"><i class="bi bi-question-circle"></i> Common Issues</h4>
                </div>
                <div class="card-body">
                    <h5>telethon is not installed</h5>
                    <pre class="code-block"><code class="language-bash">pip install telethon</code></pre>
                    
                    <h5>API ID and API Hash are required</h5>
                    <p>Set <code>TG_API_ID</code> and <code>TG_API_HASH</code> environment variables, or provide via <code>--api-id</code> and <code>--api-hash</code> flags.</p>
                    
                    <h5>SessionPasswordNeededError</h5>
                    <p>This means 2FA is enabled. The script will automatically prompt for your 2FA password.</p>
                    
                    <h5>Session file verification failed</h5>
                    <ul>
                        <li>The session may not have been saved properly</li>
                        <li>Try running the script again</li>
                        <li>Check file permissions in the output directory</li>
                    </ul>
                    
                    <h5>Rate limit exceeded</h5>
                    <ul>
                        <li>Use an existing session file if available</li>
                        <li>Wait for the rate limit to expire (check with <code>check_rate_limit.py</code>)</li>
                        <li>Use a different phone number for testing</li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="alert alert-secondary">
            <strong>Need Help?</strong> For issues or questions, check the <a href="https://github.com/redoracle/TGSentinel" target="_blank" rel="noopener noreferrer">GitHub repository</a> or open an issue.
        </div>
        </div>

        <div class="docs-tab-pane" data-docs-content="yaml" id="yaml-docs">
            <section id="yaml-overview" class="mb-5">
                <h1 class="section-header">YAML Configuration Overview</h1>
                <p class="lead">TG Sentinel uses a <strong>single source of truth</strong> architecture: Sentinel owns <code>config/tgsentinel.yml</code> and all Telegram-related configuration. The UI proxies all config operations through Sentinel's <code>/api/config</code> endpoints.</p>
                <div class="alert alert-info">
                    <strong>Config Owner:</strong> Sentinel container (single source of truth)<br>
                    <strong>Config Volume:</strong> <code>tgsentinel_sentinel_config:/app/config</code><br>
                    <strong>UI Access:</strong> Via HTTP API only (<code>GET/POST /api/config</code>)<br>
                    <strong>Architecture:</strong> Dual-database (Sentinel owns session + config, UI owns ui.db)<br>
                    <strong>Backup tip:</strong> Use <code>docker compose cp</code> or admin export endpoints.
                </div>
                <div class="alert alert-warning">
                    <strong>Important:</strong> The UI container does NOT mount <code>tgsentinel_sentinel_config</code>. All configuration changes flow through Sentinel API to maintain consistency.
                </div>
            </section>

            <section id="yaml-tgsentinel" class="mb-5">
                <h2 class="section-header">config/tgsentinel.yml (Sentinel - Single Source of Truth)</h2>
                <p>Authoritative source for all Telegram credentials, monitoring rules, alert modes, and per-channel heuristics. Managed by Sentinel, accessed by UI through <code>GET/POST /api/config</code> endpoints. Updated via <code>tgsentinel.config.load_config()</code>.</p>
                <div class="row g-3">
                    <div class="col-12 col-xl-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h3 class="card-title mb-0">Key Sections</h3>
                            </div>
                            <div class="card-body">
                                <ul class="mb-0">
                                    <li><code>telegram.api_id</code>, <code>telegram.api_hash</code>, <code>telegram.session</code></li>
                                    <li><code>alerts.mode</code>, <code>alerts.target_channel</code>, digest cadence</li>
                                    <li><code>channels[]</code> list with heuristics (<code>vip_senders</code>, keywords, thresholds, rate limits)</li>
                                    <li><code>monitored_users[]</code> list for individual user monitoring (id, name, username, enabled)</li>
                                    <li><code>interests[]</code> for semantic scoring and relevance matching</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-xl-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h3 class="card-title mb-0">Sample Snippet</h3>
                            </div>
                            <div class="card-body">
                                <pre class="code-block"><code class="language-yaml">telegram:
  api_id: 12345
  api_hash: "abcd..."
  session: "data/tgsentinel.session"
alerts:
  mode: both
  target_channel: "@alerts"
channels:
  - id: -100123
    name: "Threat Intel"
    vip_senders: ["@securityguru"]
    keywords: ["vulnerability", "exploit"]
    reaction_threshold: 5
    reply_threshold: 3
    rate_limit_per_hour: 12
monitored_users:
  - id: 789012
    name: "Security Expert"
    username: "secexp"
    enabled: true
interests:
  - "zero-day"
  - "exploit"
  - "CVE"</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="yaml-developer" class="mb-5">
                <h2 class="section-header">config/developer.yml (Optional/Legacy)</h2>
                <p>Optional UI-only developer settings managed through <code>/api/developer/settings</code>: API keys, Prometheus exporter port, feature flags, and webhook secrets hashing strategies.</p>
                <div class="alert alert-warning">
                    <strong>Note:</strong> With the single source of truth architecture, most settings now reside in <code>tgsentinel.yml</code> on Sentinel. This file is primarily for UI-specific developer features.
                </div>
                <div class="endpoint-card card">
                    <div class="card-body">
                        <pre class="code-block"><code class="language-yaml">api_keys:
  hash: "c9f0f895fb98ab9159f51fd0297e236d"
prometheus:
  enabled: true
  port: 9100
features:
  enable_console_stream: true
  enable_live_diagnostics: false</code></pre>
                        <p class="mb-0">If present, stored on UI's local filesystem. Not mounted as volume in current architecture.</p>
                    </div>
                </div>
            </section>

            <section id="yaml-webhooks" class="mb-5">
                <h2 class="section-header">config/webhooks.yml (Optional)</h2>
                <p>Optional CRUD via <code>/api/webhooks</code>. Each entry captures outbound integration metadata. Secrets are masked on reads but stored encrypted/plain depending on the service.</p>
                <div class="alert alert-warning">
                    <strong>Note:</strong> Webhook configuration is optional. Most alerting flows through Sentinel's native Telegram integration configured in <code>tgsentinel.yml</code>.
                </div>
                <div class="endpoint-card card">
                    <div class="card-body">
                        <pre class="code-block"><code class="language-yaml">webhooks:
  slack:
    url: "https://hooks.slack.com/services/T00/B00/XXX"
    secret: "***"
    enabled: true
  discord:
    url: "https://discord.com/api/webhooks/..."
    secret: "***"
    enabled: false</code></pre>
                        <p class="mb-0">If used, managed independently from main Sentinel configuration.</p>
                    </div>
                </div>
            </section>

            <section id="yaml-volumes" class="mb-5">
                <h2 class="section-header">Docker Volume Mapping</h2>
                <p>Reference from <code>docker-compose.yml</code>. Sentinel owns the configuration volume (single source of truth). UI accesses config via HTTP API only.</p>
                <pre class="code-block"><code class="language-yaml">services:
  sentinel:
    volumes:
      - tgsentinel_sentinel_config:/app/config  # Config owner
      - tgsentinel_sentinel_data:/app/data      # Session + sentinel.db
    environment:
      - TG_CONFIG_PATH=/app/config/tgsentinel.yml
  
  ui:
    volumes:
      - tgsentinel_ui_data:/app/data            # UI-only: ui.db
    environment:
      - SENTINEL_API_BASE_URL=http://sentinel:8080/api

volumes:
  tgsentinel_sentinel_config:  # Sentinel-only config volume
  tgsentinel_sentinel_data:    # Sentinel-only data (session + DB)
  tgsentinel_ui_data:          # UI-only data (ui.db)</code></pre>
                <div class="alert alert-danger">
                    <strong>Critical:</strong> The UI container does <strong>NOT</strong> mount <code>tgsentinel_sentinel_config</code>. All config operations go through <code>GET/POST /api/config</code> endpoints. Never share config volumes between containers.
                </div>
                <h5 class="mt-4">Architecture Benefits</h5>
                <ul>
                    <li><strong>Single Source of Truth:</strong> Sentinel owns config, eliminating sync conflicts</li>
                    <li><strong>Clean Separation:</strong> UI never directly accesses session files or Sentinel DB</li>
                    <li><strong>API-First:</strong> All config changes flow through validated HTTP endpoints</li>
                    <li><strong>Session Security:</strong> Telethon session isolated in Sentinel container</li>
                </ul>
            </section>
        </div>

        <div class="docs-tab-pane" data-docs-content="manual" id="manual-docs">
            <section id="manual-overview" class="mb-5">
                <h1 class="section-header">User Manual Overview</h1>
                <p class="lead">Welcome to the TG Sentinel User Manual. This comprehensive guide will help you get started with monitoring Telegram channels, configuring alerts, and managing your workflow.</p>
                <div class="alert alert-info">
                    <strong>Quick Navigation:</strong> Use the sidebar to jump to specific topics, or scroll through to learn about TG Sentinel's features step-by-step.
                    <br><br>
                    TG Sentinel is a privacy-preserving Telegram monitoring system that intelligently filters messages from channels, groups, and chats using keyword-based heuristics and semantic scoring. It provides powerful monitoring, customizable alerting, and strict privacy safeguards to help you stay informed without information overload. Use the sidebar navigation to jump directly to topics of interest, or follow the sections step-by-step to learn the complete workflow.
                </div>
            </section>

            <section id="manual-getting-started" class="mb-5">
                <h2 class="section-header">Getting Started</h2>
                <p class="lead">TG Sentinel is a privacy-preserving Telegram monitoring system that intelligently filters messages using keyword-based and semantic scoring.</p>
                
                <h3 class="mt-4">Quick Start Steps</h3>
                <ol>
                    <li><strong>Session Setup:</strong> Upload your Telegram session file to connect to your account</li>
                    <li><strong>Configure Monitoring:</strong> Select channels and groups to monitor in the Settings page</li>
                    <li><strong>Create Profiles:</strong> Define Alert and Interest profiles to filter important messages</li>
                    <li><strong>Review Alerts:</strong> Check the Alerts page for filtered messages that match your criteria</li>
                </ol>

                <div class="alert alert-warning mt-3">
                    <strong>Privacy Note:</strong> Your Telegram session is stored locally and never shared. All message processing happens on your device.
                </div>
            </section>

            <section id="manual-profiles" class="mb-5">
                <h2 class="section-header">Profile Management</h2>
                <p class="lead">Profiles are the core of TG Sentinel's filtering system. They define what messages are important to you and how they should be detected.</p>
                
                <p>There are two types of profiles available:</p>
                <ul>
                    <li><strong>Alert Profiles:</strong> Keyword-based detection using pattern matching</li>
                    <li><strong>Interest Profiles:</strong> Semantic detection using AI to understand message meaning</li>
                </ul>
            </section>

            <section id="alert-profiles" class="mb-5">
                <h2 class="section-header">Alert Profiles</h2>
                <p class="lead">Alert Profiles use keyword-based detection to identify important messages based on specific terms and patterns.</p>
                
                <h3 class="mt-4">Keyword Categories</h3>
                <p>Alert profiles organize keywords into eight categories, each with different priority levels:</p>
                
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🔴 Critical Keywords</h5>
                                <p class="card-text">Highest priority terms that trigger immediate alerts. Examples: exploit, breach, hack, zero-day</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🔒 Security Keywords</h5>
                                <p class="card-text">Security-related terms. Examples: vulnerability, attack, malicious, phishing</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">⏰ Urgency Keywords</h5>
                                <p class="card-text">Time-sensitive indicators. Examples: urgent, asap, critical, immediate</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">💰 Financial Keywords</h5>
                                <p class="card-text">Market and financial terms. Examples: price, trading, pump, dump</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">⚙️ Technical Keywords</h5>
                                <p class="card-text">Development and tech terms. Examples: update, upgrade, release, fork</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🎯 Project Keywords</h5>
                                <p class="card-text">Project-specific terms. Examples: roadmap, milestone, governance</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">👥 Community Keywords</h5>
                                <p class="card-text">Community engagement terms. Examples: announcement, airdrop, vote, AMA</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">📰 General Keywords</h5>
                                <p class="card-text">General interest terms. Examples: news, update, important, alert</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-4">How Keyword Detection Works</h3>
                <p>When a message arrives, TG Sentinel:</p>
                <ol>
                    <li>Checks if any keywords match (case-insensitive)</li>
                    <li>Calculates a score based on keyword category and frequency</li>
                    <li>Applies multipliers for VIP senders or special patterns</li>
                    <li>Triggers an alert if the score exceeds the minimum threshold</li>
                </ol>

                <h3 class="mt-4">Best Practices</h3>
                <ul>
                    <li>Use comma-separated values for multiple keywords</li>
                    <li>Combine related terms in the same category</li>
                    <li>Start with broad terms and refine based on results</li>
                    <li>Use the Backtest feature to test your keywords against historical messages</li>
                </ul>
            </section>

            <section id="interest-profiles" class="mb-5">
                <h2 class="section-header">Interest Profiles</h2>
                <p class="lead">Interest Profiles use semantic AI to understand the meaning of messages, not just keywords. This allows for more intelligent filtering based on topics and concepts.</p>
                
                <h3 class="mt-4">How Semantic Detection Works</h3>
                <p>Interest profiles are powered by the <strong>all-MiniLM-L6-v2</strong> sentence transformer model, which:</p>
                <ul>
                    <li>Converts messages into numerical vectors representing their meaning</li>
                    <li>Compares new messages against your positive examples</li>
                    <li>Assigns similarity scores from 0.00 (completely different) to 1.00 (nearly identical)</li>
                    <li>Triggers alerts when similarity exceeds your threshold</li>
                </ul>

                <h3 class="mt-4">Creating an Interest Profile</h3>
                <ol>
                    <li><strong>Topic Name:</strong> Give your profile a descriptive name (e.g., "blockchain security advisories")</li>
                    <li><strong>Positive Examples:</strong> Paste 5-10 messages that represent what you want to detect (one per line)</li>
                    <li><strong>Negative Examples (Optional):</strong> Add examples of what should NOT match to refine accuracy</li>
                    <li><strong>Threshold:</strong> Set similarity threshold (default 0.42). Lower = more matches, higher = stricter filtering</li>
                </ol>

                <h3 class="mt-4">Advanced Configuration</h3>
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Configuration Options</h5>
                        <ul>
                            <li><strong>Similarity Threshold:</strong> Range 0.0-1.0, controls how closely messages must match</li>
                            <li><strong>Profile Weight:</strong> Multiplier for this profile's importance (0-10)</li>
                            <li><strong>Priority:</strong> Low, Normal, High, or Critical alert priority</li>
                            <li><strong>Keywords:</strong> Optional keywords to boost scoring for specific terms</li>
                            <li><strong>Tags:</strong> Organizational labels for filtering and grouping profiles</li>
                            <li><strong>Always Notify:</strong> Bypass other filters and always alert on matches</li>
                            <li><strong>Include in Digest:</strong> Whether matches appear in scheduled digests</li>
                        </ul>
                    </div>
                </div>

                <h3 class="mt-4">Interpreting Similarity Scores</h3>
                <ul>
                    <li><strong>0.00 - 0.30:</strong> Very different from profile interests</li>
                    <li><strong>0.30 - 0.50:</strong> Somewhat related</li>
                    <li><strong>0.50 - 0.70:</strong> Moderately similar</li>
                    <li><strong>0.70 - 0.85:</strong> Highly similar</li>
                    <li><strong>0.85 - 1.00:</strong> Very closely matches profile</li>
                </ul>

                <h3 class="mt-4">Best Practices</h3>
                <ul>
                    <li>Provide diverse positive examples that cover different aspects of your interest</li>
                    <li>Start with a threshold of 0.42 and adjust based on results</li>
                    <li>Use negative examples to exclude common false positives</li>
                    <li>Test your profile using the Backtest feature before activating</li>
                    <li>Combine with keyword boosting for hybrid detection</li>
                </ul>
            </section>

            <section id="detection-settings" class="mb-5">
                <h2 class="section-header">Detection Settings</h2>
                <p class="lead">Fine-tune how alert profiles detect and filter messages with these advanced settings.</p>
                
                <h3 class="mt-4">Core Settings</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Setting</th>
                                <th>Description</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Minimum Score</strong></td>
                                <td>Threshold for triggering alerts (0-10 scale)</td>
                                <td>Set to 5.0 for medium sensitivity</td>
                            </tr>
                            <tr>
                                <td><strong>VIP Senders</strong></td>
                                <td>Always alert from these users, regardless of score</td>
                                <td>@vitalik, @satoshi</td>
                            </tr>
                            <tr>
                                <td><strong>Excluded Users</strong></td>
                                <td>Never alert from these users (blacklist)</td>
                                <td>@spammer, @bot_account</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="mt-4">Detection Toggles</h3>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">❓ Detect Questions</h5>
                                <p class="card-text">Boost score for messages containing question marks or interrogative patterns</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">@️ Detect Mentions</h5>
                                <p class="card-text">Boost score for messages mentioning specific users or @everyone tags</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🔗 Detect Links</h5>
                                <p class="card-text">Boost score for messages containing URLs or external links</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">📤 Only Forwards</h5>
                                <p class="card-text">Only alert on forwarded messages (ignores original posts)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-4">Score Calculation</h3>
                <p>The final alert score is calculated using:</p>
                <pre><code>Final Score = Base Score + Category Bonuses + Pattern Multipliers

Where:
- Base Score: Match frequency × keyword priority
- Category Bonuses: Question (+2), Mention (+3), Link (+1)
- Pattern Multipliers: VIP sender (×2), Multiple keywords (×1.5)</code></pre>
            </section>

            <section id="profile-scope" class="mb-5">
                <h2 class="section-header">Profile Scope (Apply Profile To)</h2>
                <p class="lead">Control which channels, groups, and users a profile monitors. This allows targeted filtering and prevents alert overload.</p>
                
                <h3 class="mt-4">How Profile Scope Works</h3>
                <p>By default, profiles apply to <strong>all monitored entities</strong> configured in your Settings. However, you can restrict profiles to specific sources:</p>

                <h3 class="mt-4">Selecting Entities</h3>
                <ol>
                    <li>Click the <strong>+ ADD</strong> button in the "Apply Profile To" section</li>
                    <li>A modal opens showing all your monitored channels and users</li>
                    <li>Check the boxes next to channels/users where this profile should be active</li>
                    <li>Click <strong>Confirm Selection</strong> to save</li>
                </ol>

                <h3 class="mt-4">Entity Types</h3>
                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">📢 Channels</h5>
                                <p class="card-text">Public broadcast channels (one-way communication)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">👥 Groups</h5>
                                <p class="card-text">Group chats with multiple participants</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">💬 Users</h5>
                                <p class="card-text">Direct messages from individual users</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-4">Use Cases</h3>
                <ul>
                    <li><strong>Topic-Specific Monitoring:</strong> Apply crypto profiles only to blockchain channels</li>
                    <li><strong>Noise Reduction:</strong> Exclude meme groups from serious alert profiles</li>
                    <li><strong>VIP Tracking:</strong> Create profiles that only monitor specific influential users</li>
                    <li><strong>Language Separation:</strong> Apply language-specific profiles to corresponding channels</li>
                </ul>

                <div class="alert alert-info mt-3">
                    <strong>Tip:</strong> Leave the scope empty for general-purpose profiles that should monitor everything. Use scoping for specialized profiles.
                </div>
            </section>

            <section id="digest-api" class="mb-5">
                <h2 class="section-header">Digest Schedules</h2>
                <p class="lead">Instead of instant alerts for every message, digest schedules batch messages and send summaries at regular intervals.</p>
                
                <h3 class="mt-4">Why Use Digests?</h3>
                <ul>
                    <li><strong>Reduce Alert Fatigue:</strong> Batch low-priority messages into periodic summaries</li>
                    <li><strong>Focus Time:</strong> Receive alerts only at specific times of day</li>
                    <li><strong>Prioritization:</strong> Separate urgent alerts from routine updates</li>
                    <li><strong>Context:</strong> See multiple related messages together for better understanding</li>
                </ul>

                <h3 class="mt-4">Schedule Types</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Schedule</th>
                                <th>Frequency</th>
                                <th>Best For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>⏰ Hourly</td>
                                <td>Every 60 minutes</td>
                                <td>Active channels with frequent updates</td>
                            </tr>
                            <tr>
                                <td>🕓 Every 4 Hours</td>
                                <td>6 times per day</td>
                                <td>Medium-priority monitoring</td>
                            </tr>
                            <tr>
                                <td>🕕 Every 6 Hours</td>
                                <td>4 times per day</td>
                                <td>Low-priority channels</td>
                            </tr>
                            <tr>
                                <td>🕛 Every 12 Hours</td>
                                <td>Twice per day</td>
                                <td>Background monitoring</td>
                            </tr>
                            <tr>
                                <td>📅 Daily</td>
                                <td>Once per day at specified hour (UTC)</td>
                                <td>Daily summaries, morning briefings</td>
                            </tr>
                            <tr>
                                <td>📊 Weekly</td>
                                <td>Once per week on specified day/hour (UTC)</td>
                                <td>Weekly roundups, low-traffic channels</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="mt-4">Configuring Digest Schedules</h3>
                <p>Each profile supports up to <strong>3 independent schedules</strong>. For example:</p>
                <ul>
                    <li><strong>Schedule 1:</strong> Hourly digest, top 10 messages, min score 7.0 (most urgent)</li>
                    <li><strong>Schedule 2:</strong> Every 6 hours, top 20 messages, min score 5.0 (medium priority)</li>
                    <li><strong>Schedule 3:</strong> Daily at 8:00 UTC, top 30 messages, min score 3.0 (comprehensive review)</li>
                </ul>

                <h3 class="mt-4">Schedule Parameters</h3>
                <div class="card mt-3">
                    <div class="card-body">
                        <h5>Configuration Options</h5>
                        <ul>
                            <li><strong>Schedule Type:</strong> Choose frequency (hourly, daily, weekly, etc.)</li>
                            <li><strong>Top N Messages:</strong> Maximum messages to include (1-100)</li>
                            <li><strong>Min Score:</strong> Minimum alert score threshold (0-10)</li>
                            <li><strong>Daily Hour:</strong> Hour of day for daily digests (0-23 UTC)</li>
                            <li><strong>Weekly Day:</strong> Day of week for weekly digests (Monday-Sunday)</li>
                            <li><strong>Weekly Hour:</strong> Hour of day for weekly digests (0-23 UTC)</li>
                        </ul>
                    </div>
                </div>

                <h3 class="mt-4">Delivery Settings</h3>
                <p>Control where digests are sent:</p>
                <ul>
                    <li><strong>💬 DM Only:</strong> Send to your Saved Messages (private)</li>
                    <li><strong>📢 Channel Only:</strong> Post to a specified channel</li>
                    <li><strong>🔄 Both DM & Channel:</strong> Send to both destinations</li>
                </ul>

                <h3 class="mt-4">Best Practices</h3>
                <ul>
                    <li>Use instant alerts (Schedule 1 = None) for critical profiles</li>
                    <li>Set different score thresholds for each schedule (high to low)</li>
                    <li>Adjust "Top N" based on channel volume</li>
                    <li>Schedule daily digests during your focus time (e.g., 8:00 AM)</li>
                    <li>Use weekly digests for low-priority background monitoring</li>
                </ul>

                <div class="alert alert-warning mt-3">
                    <strong>Note:</strong> All times are in UTC. Convert to your local timezone when scheduling.
                </div>
            </section>

            <section id="alerts-api" class="mb-5">
                <h2 class="section-header">Alerts & Notifications</h2>
                <p class="lead">The Alerts page is your central hub for reviewing filtered messages that match your configured profiles.</p>
                
                <h3 class="mt-4">Alert Feed</h3>
                <p>The main alert feed displays messages that triggered your Alert or Interest profiles, sorted by score and timestamp.</p>
                
                <h4 class="mt-3">Alert Card Information</h4>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Score Badge</strong></td>
                                <td>Numeric score (0-10) with color coding: red (critical), orange (high), yellow (medium), green (low)</td>
                            </tr>
                            <tr>
                                <td><strong>Channel/User</strong></td>
                                <td>Source of the message with avatar icon</td>
                            </tr>
                            <tr>
                                <td><strong>Sender Name</strong></td>
                                <td>Original message author</td>
                            </tr>
                            <tr>
                                <td><strong>Message Text</strong></td>
                                <td>Full message content with keyword highlighting</td>
                            </tr>
                            <tr>
                                <td><strong>Matched Profiles</strong></td>
                                <td>List of profiles that triggered this alert</td>
                            </tr>
                            <tr>
                                <td><strong>Timestamp</strong></td>
                                <td>When the message was sent</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="mt-4">Filtering & Search</h3>
                <ul>
                    <li><strong>Text Search:</strong> Filter alerts by keyword, sender, or channel name</li>
                    <li><strong>Score Range:</strong> Show only alerts within specific score ranges</li>
                    <li><strong>Date Range:</strong> Filter by time period (today, last 7 days, custom)</li>
                    <li><strong>Profile Filter:</strong> View alerts from specific profiles only</li>
                    <li><strong>Channel Filter:</strong> Show alerts from particular channels</li>
                </ul>

                <h3 class="mt-4">Alert Actions</h3>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">👍 Mark Relevant</h5>
                                <p class="card-text">Confirm this alert was useful (helps improve profile accuracy)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">👎 Mark Irrelevant</h5>
                                <p class="card-text">Flag false positives (trains the system to reduce noise)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🔗 Open in Telegram</h5>
                                <p class="card-text">Jump directly to the message in Telegram app</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🗑️ Dismiss</h5>
                                <p class="card-text">Remove from alert feed without providing feedback</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-4">Bulk Operations</h3>
                <p>Select multiple alerts to perform batch actions:</p>
                <ul>
                    <li>Mark all as relevant/irrelevant</li>
                    <li>Dismiss multiple alerts at once</li>
                    <li>Export selected alerts as JSON</li>
                </ul>
            </section>

            <section id="configuration" class="mb-5">
                <h2 class="section-header">Configuration / Settings</h2>
                <p class="lead">The Configuration page (Settings) allows you to fine-tune TG Sentinel's behavior and manage monitoring sources.</p>
            </section>

            <section id="telegram-config" class="mb-5">
                <h3 class="section-header">Telegram Settings</h3>
                <p>Core Telegram API and session configuration.</p>
                
                <h4 class="mt-3">Session Management</h4>
                <ul>
                    <li><strong>Session Upload:</strong> Upload your Telegram .session file to authenticate</li>
                    <li><strong>Session Status:</strong> View connection status and account information</li>
                    <li><strong>Logout:</strong> Disconnect and clear session data</li>
                </ul>

                <h4 class="mt-3">API Configuration</h4>
                <div class="alert alert-warning">
                    <strong>Required:</strong> You need API credentials from <a href="https://my.telegram.org/apps" target="_blank" rel="noopener" class="alert-link">my.telegram.org/apps</a>
                </div>
                <ul>
                    <li><strong>API ID:</strong> Your Telegram API application ID</li>
                    <li><strong>API Hash:</strong> Your Telegram API application hash</li>
                    <li><strong>Phone Number:</strong> Account phone number for session generation</li>
                </ul>
            </section>

            <section id="alerts-config" class="mb-5">
                <h3 class="section-header">Alert Configuration</h3>
                <p>Control how and when alerts are triggered and delivered.</p>
                
                <h4 class="mt-3">Delivery Options</h4>
                <ul>
                    <li><strong>Real-time Notifications:</strong> Enable/disable instant alerts</li>
                    <li><strong>Notification Sound:</strong> Customize alert sounds</li>
                    <li><strong>Desktop Notifications:</strong> Browser notifications for urgent alerts</li>
                    <li><strong>Saved Messages:</strong> Automatically send alerts to Telegram Saved Messages</li>
                </ul>

                <h4 class="mt-3">Alert Thresholds</h4>
                <ul>
                    <li><strong>Global Minimum Score:</strong> Universal threshold below which messages are ignored</li>
                    <li><strong>Rate Limiting:</strong> Max alerts per hour/day to prevent spam</li>
                    <li><strong>Cooldown Period:</strong> Silence alerts from same source for specified time</li>
                </ul>

                <h4 class="mt-3">Feedback Learning</h4>
                <p>Enable the system to learn from your feedback on alerts to improve future accuracy:</p>
                <ul>
                    <li><strong>Feedback Learning Toggle:</strong> When enabled, the system learns from your 👍/👎 reactions on alerts</li>
                    <li><strong>How It Works:</strong> Your feedback is stored and used to adjust scoring weights over time</li>
                    <li><strong>Feedback Accuracy:</strong> View feedback statistics in the Analytics dashboard</li>
                    <li><strong>Privacy:</strong> Feedback data is stored locally and never leaves your instance</li>
                </ul>
                <div class="alert alert-info mt-3">
                    <strong>💡 Tip:</strong> Regularly provide feedback on alerts to help the system better understand your preferences and reduce false positives.
                </div>
            </section>

            <section id="advanced-config" class="mb-5">
                <h3 class="section-header">Advanced Settings</h3>
                <p>Global system configuration for semantic matching and message processing.</p>
                
                <div class="alert alert-info">
                    <strong>📌 Note:</strong> For keyword matching, scoring thresholds, and detection rules, use the <a href="/profiles" class="alert-link">Profiles</a> page to configure Alert Profiles and Interest Profiles.
                </div>

                <h4 class="mt-3">Embedding Model</h4>
                <p>Choose the AI model used for semantic similarity matching across all Interest Profiles:</p>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Characteristics</th>
                                <th>Best For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>all-MiniLM-L6-v2</code></td>
                                <td>Fast, efficient, 80MB</td>
                                <td>Real-time processing, resource-constrained environments</td>
                            </tr>
                            <tr>
                                <td><code>bge-small-en</code></td>
                                <td>More accurate, 130MB</td>
                                <td>Better semantic understanding, can handle more complex queries</td>
                            </tr>
                            <tr>
                                <td>Custom</td>
                                <td>User-provided model</td>
                                <td>Specialized use cases, domain-specific embeddings</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="alert alert-warning mt-3">
                    <strong>⚠️ Performance Impact:</strong> Changing the embedding model requires restarting the Sentinel service and may take a few minutes to load the new model.
                </div>

                <h4 class="mt-3">Decay Window</h4>
                <p>Global time-based relevance decay for all messages:</p>
                <ul><li><strong>Default:</strong> 24 hours - Messages older than 24 hours gradually lose importance</li>
                    <li><strong>Purpose:</strong> Prevents alert fatigue by reducing relevance of older topics</li>
                    <li><strong>How It Works:</strong> Importance score decreases linearly over the decay window</li>
                    <li><strong>Customization:</strong> Set between 1 hour (aggressive decay) to 168 hours/7 days (slow decay)</li>
                </ul>
                <div class="alert alert-success mt-3">
                    <strong>💡 Best Practice:</strong> Use 24 hours for fast-moving topics (crypto, trading) and 48-72 hours for slower news cycles (research, development updates).
                </div>

                <h4 class="mt-3">Profile-Based Configuration</h4>
                <p>The following settings have been moved to per-profile configuration for better flexibility:</p>
                <ul>
                    <li><strong>Similarity Thresholds:</strong> Now configured per Interest Profile in the Profiles page</li>
                    <li><strong>Keyword Categories:</strong> Managed via Alert Profiles (Critical, Security, Urgency, Financial, etc.)</li>
                    <li><strong>Detection Rules:</strong> Set per Alert Profile (questions, mentions, links, forwards)</li>
                    <li><strong>Scoring Weights:</strong> Each profile can have its own weight and priority settings</li>
                </ul>
                <div class="alert alert-primary mt-3">
                    <strong>🎯 Recommendation:</strong> Visit the <a href="/profiles" class="alert-link">Profiles</a> page to create and manage Alert Profiles (keyword-based) and Interest Profiles (semantic matching) for granular control over message detection and scoring.
                </div>
            </section>

            <section id="channels-api" class="mb-5">
                <h3 class="section-header">Channels Management</h3>
                <p>Monitor public Telegram channels and manage their settings.</p>
                
                <h4 class="mt-3">Adding Channels</h4>
                <ol>
                    <li>Click <strong>+ Add Channel</strong></li>
                    <li>Enter channel username (e.g., @channelname) or invite link</li>
                    <li>TG Sentinel will join and begin monitoring</li>
                    <li>Configure per-channel settings (filters, mute times, priority)</li>
                </ol>

                <h4 class="mt-3">Channel Settings</h4>
                <ul>
                    <li><strong>Monitoring Status:</strong> Enable/disable monitoring per channel</li>
                    <li><strong>Profile Override:</strong> Apply specific profiles to this channel</li>
                    <li><strong>Score Threshold:</strong> Custom minimum score for this channel</li>
                    <li><strong>Mute Schedule:</strong> Silence alerts during specific hours</li>
                    <li><strong>Language Filter:</strong> Skip messages in certain languages</li>
                </ul>

                <h4 class="mt-3">Bulk Actions</h4>
                <ul>
                    <li>Enable/disable monitoring for multiple channels</li>
                    <li>Apply profile templates to channel groups</li>
                    <li>Export channel list as JSON</li>
                </ul>
            </section>

            <section id="users-api" class="mb-5">
                <h3 class="section-header">Users Management</h3>
                <p>Monitor direct messages and private conversations.</p>
                
                <h4 class="mt-3">Adding Users</h4>
                <ol>
                    <li>Click <strong>+ Add User</strong></li>
                    <li>Enter username (e.g., @username) or phone number</li>
                    <li>Set monitoring preferences for this user</li>
                </ol>

                <h4 class="mt-3">User Categories</h4>
                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">⭐ VIP Users</h5>
                                <p class="card-text">Always alert, regardless of content</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">👥 Regular Users</h5>
                                <p class="card-text">Normal profile-based filtering</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🚫 Blocked Users</h5>
                                <p class="card-text">Never alert from these users</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="system-config" class="mb-5">
                <h3 class="section-header">System Settings</h3>
                <p>Global application settings and performance tuning.</p>
                
                <h4 class="mt-3">Performance Options</h4>
                <ul>
                    <li><strong>Message Retention:</strong> How long to keep messages in database (days)</li>
                    <li><strong>Cache Size:</strong> Redis cache limits for avatars and metadata</li>
                    <li><strong>Batch Size:</strong> Number of messages to process simultaneously</li>
                    <li><strong>Polling Interval:</strong> How often to check for new messages (seconds)</li>
                </ul>

                <h4 class="mt-3">Privacy & Security</h4>
                <ul>
                    <li><strong>UI Lock Password:</strong> Password-protect the web interface</li>
                    <li><strong>Session Encryption:</strong> Encrypt session file at rest</li>
                    <li><strong>Log Level:</strong> Control verbosity (DEBUG, INFO, WARNING, ERROR)</li>
                    <li><strong>Anonymize Logs:</strong> Remove sensitive data from logs</li>
                </ul>

                <h4 class="mt-3">Data Management</h4>
                <ul>
                    <li><strong>Auto-vacuum:</strong> Automatic database optimization</li>
                    <li><strong>Backup Schedule:</strong> Automated session backups</li>
                    <li><strong>Export Format:</strong> Default format for data exports (JSON, CSV)</li>
                </ul>
            </section>

            <section id="analytics" class="mb-5">
                <h2 class="section-header">Analytics & Insights</h2>
                <p class="lead">Visualize and analyze your monitoring data with comprehensive metrics and charts.</p>
            </section>

            <section id="performance-metrics" class="mb-5">
                <h3 class="section-header">Performance Metrics</h3>
                <p>Track system performance and message processing efficiency.</p>
                
                <h4 class="mt-3">Key Metrics</h4>
                <div class="row g-3 mt-2">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">📊 Messages/Hour</h5>
                                <p class="card-text">Ingestion rate</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">⚡ Processing Time</h5>
                                <p class="card-text">Avg latency per message</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🎯 Alert Rate</h5>
                                <p class="card-text">% of messages alerted</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">✅ Accuracy</h5>
                                <p class="card-text">Relevant vs false positives</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 class="mt-4">Time-Series Charts</h4>
                <ul>
                    <li><strong>Message Volume:</strong> Incoming messages over time</li>
                    <li><strong>Alert Triggers:</strong> Alert frequency by hour/day/week</li>
                    <li><strong>Score Distribution:</strong> Histogram of message scores</li>
                    <li><strong>Processing Latency:</strong> Performance over time</li>
                </ul>
            </section>

            <section id="resource-metrics" class="mb-5">
                <h3 class="section-header">Resource Monitoring</h3>
                <p>Monitor system resource usage and identify bottlenecks.</p>
                
                <h4 class="mt-3">Resource Graphs</h4>
                <ul>
                    <li><strong>CPU Usage:</strong> Real-time CPU utilization</li>
                    <li><strong>Memory:</strong> RAM consumption by component</li>
                    <li><strong>Database Size:</strong> SQLite file size and growth rate</li>
                    <li><strong>Redis Cache:</strong> Cache hit rate and memory usage</li>
                    <li><strong>Network:</strong> Telegram API bandwidth usage</li>
                </ul>

                <h4 class="mt-3">Health Indicators</h4>
                <div class="alert alert-success">
                    <strong>🟢 Healthy:</strong> All systems operational, performance within normal range
                </div>
                <div class="alert alert-warning">
                    <strong>🟡 Warning:</strong> Resource usage elevated, may impact performance
                </div>
                <div class="alert alert-danger">
                    <strong>🔴 Critical:</strong> System resources exhausted, immediate action required
                </div>
            </section>

            <section id="keyword-heatmap" class="mb-5">
                <h3 class="section-header">Keyword Heatmap</h3>
                <p>Visualize keyword frequency and effectiveness across all monitored channels.</p>
                
                <h4 class="mt-3">Heatmap Features</h4>
                <ul>
                    <li><strong>Word Cloud:</strong> Visual representation of most frequent keywords</li>
                    <li><strong>Trend Analysis:</strong> Track keyword popularity over time</li>
                    <li><strong>Category Breakdown:</strong> Keywords grouped by profile category</li>
                    <li><strong>Effectiveness Score:</strong> Which keywords trigger the most relevant alerts</li>
                </ul>

                <h4 class="mt-3">Using the Heatmap</h4>
                <ol>
                    <li>Identify overused keywords that generate noise</li>
                    <li>Discover emerging terms to add to profiles</li>
                    <li>Optimize keyword lists based on actual performance</li>
                    <li>Compare keyword effectiveness across channels</li>
                </ol>
            </section>

            <section id="channel-impact" class="mb-5">
                <h3 class="section-header">Channel Impact Analysis</h3>
                <p>Evaluate which channels provide the most valuable alerts.</p>
                
                <h4 class="mt-3">Impact Metrics</h4>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Description</th>
                                <th>Interpretation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Alert Volume</strong></td>
                                <td>Total alerts triggered</td>
                                <td>Raw activity level</td>
                            </tr>
                            <tr>
                                <td><strong>Relevance Rate</strong></td>
                                <td>% of alerts marked relevant</td>
                                <td>Quality indicator</td>
                            </tr>
                            <tr>
                                <td><strong>Avg Score</strong></td>
                                <td>Mean alert score</td>
                                <td>Overall importance</td>
                            </tr>
                            <tr>
                                <td><strong>Signal/Noise</strong></td>
                                <td>Useful vs total messages</td>
                                <td>Efficiency metric</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="mt-3">Recommendations</h4>
                <p>Based on impact analysis, TG Sentinel suggests:</p>
                <ul>
                    <li>Channels to prioritize (high relevance, high value)</li>
                    <li>Channels to reconfigure (high volume, low relevance)</li>
                    <li>Channels to unmonitor (low signal/noise ratio)</li>
                </ul>
            </section>

            <section id="developer" class="mb-5">
                <h2 class="section-header">Developer & Integrations</h2>
                <p class="lead">Extend TG Sentinel with custom integrations, webhooks, and API access.</p>
            </section>

            <section id="integration-settings" class="mb-5">
                <h3 class="section-header">Integration Settings</h3>
                <p>Configure external services and API connections.</p>
                
                <h4 class="mt-3">Available Integrations</h4>
                <ul>
                    <li><strong>Slack:</strong> Send alerts to Slack channels</li>
                    <li><strong>Discord:</strong> Forward alerts to Discord webhooks</li>
                    <li><strong>Email:</strong> Email alerts via SMTP</li>
                    <li><strong>Custom Webhooks:</strong> HTTP POST to any endpoint</li>
                    <li><strong>Database Export:</strong> Sync to external databases</li>
                </ul>

                <h4 class="mt-3">API Access</h4>
                <div class="alert alert-info">
                    <strong>API Base URL:</strong> <code>http://localhost:5001/api</code>
                </div>
                <ul>
                    <li><strong>Authentication:</strong> API key or session token</li>
                    <li><strong>Rate Limits:</strong> 100 requests/minute per key</li>
                    <li><strong>Documentation:</strong> OpenAPI/Swagger available at <code>/docs</code></li>
                </ul>
            </section>

            <section id="webhooks-api" class="mb-5">
                <h3 class="section-header">Webhooks</h3>
                <p>Real-time event notifications via HTTP callbacks.</p>
                
                <h4 class="mt-3">Webhook Events</h4>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Event</th>
                                <th>Trigger</th>
                                <th>Payload</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>alert.triggered</code></td>
                                <td>New alert created</td>
                                <td>Full alert data</td>
                            </tr>
                            <tr>
                                <td><code>message.ingested</code></td>
                                <td>Message processed</td>
                                <td>Message + scores</td>
                            </tr>
                            <tr>
                                <td><code>profile.updated</code></td>
                                <td>Profile modified</td>
                                <td>Profile config</td>
                            </tr>
                            <tr>
                                <td><code>channel.added</code></td>
                                <td>New channel monitored</td>
                                <td>Channel metadata</td>
                            </tr>
                            <tr>
                                <td><code>digest.sent</code></td>
                                <td>Digest delivered</td>
                                <td>Digest summary</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="mt-3">Webhook Configuration</h4>
                <pre><code class="language-json">{
  "url": "https://your-endpoint.com/webhook",
  "events": ["alert.triggered", "message.ingested"],
  "secret": "your-webhook-secret",
  "retry": {
    "max_attempts": 3,
    "backoff": "exponential"
  }
}</code></pre>

                <h4 class="mt-3">Security</h4>
                <ul>
                    <li><strong>HMAC Signatures:</strong> Verify webhook authenticity with SHA256</li>
                    <li><strong>IP Allowlist:</strong> Restrict webhook sources</li>
                    <li><strong>TLS Required:</strong> HTTPS only for webhook endpoints</li>
                </ul>
            </section>

            <section id="integration-console" class="mb-5">
                <h3 class="section-header">Integration Console</h3>
                <p>Test and debug integrations in real-time.</p>
                
                <h4 class="mt-3">Console Features</h4>
                <ul>
                    <li><strong>Live Logs:</strong> Watch integration events as they happen</li>
                    <li><strong>Webhook Tester:</strong> Send test payloads to verify configuration</li>
                    <li><strong>API Explorer:</strong> Interactive API documentation and testing</li>
                    <li><strong>Error Inspector:</strong> Debug failed webhook deliveries</li>
                </ul>

                <h4 class="mt-3">Testing Webhooks</h4>
                <ol>
                    <li>Create a webhook configuration</li>
                    <li>Click <strong>Send Test Event</strong></li>
                    <li>Select event type and customize payload</li>
                    <li>Review response status and delivery logs</li>
                </ol>
            </section>

            <section id="console" class="mb-5">
                <h2 class="section-header">Console & Maintenance</h2>
                <p class="lead">System administration, maintenance tools, and diagnostic utilities.</p>
            </section>

            <section id="console-logs" class="mb-5">
                <h3 class="section-header">Log Viewer</h3>
                <p>Real-time log streaming and historical log analysis.</p>
                
                <h4 class="mt-3">Log Levels</h4>
                <ul>
                    <li><strong>🔴 ERROR:</strong> Critical failures requiring attention</li>
                    <li><strong>🟡 WARNING:</strong> Potential issues or degraded performance</li>
                    <li><strong>🔵 INFO:</strong> General operational messages</li>
                    <li><strong>⚪ DEBUG:</strong> Detailed diagnostic information</li>
                </ul>

                <h4 class="mt-3">Log Filtering</h4>
                <ul>
                    <li>Filter by log level (ERROR, WARNING, INFO, DEBUG)</li>
                    <li>Search by keyword or regex pattern</li>
                    <li>Filter by component (Sentinel, UI, Redis)</li>
                    <li>Time range selection</li>
                </ul>

                <h4 class="mt-3">Log Actions</h4>
                <ul>
                    <li><strong>Download Logs:</strong> Export as text file</li>
                    <li><strong>Clear Display:</strong> Clear current view (doesn't delete files)</li>
                    <li><strong>Pause/Resume:</strong> Stop/start live streaming</li>
                </ul>
            </section>

            <section id="console-commands" class="mb-5">
                <h3 class="section-header">System Commands</h3>
                <p>Administrative commands for system management.</p>
                
                <h4 class="mt-3">Available Commands</h4>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Command</th>
                                <th>Description</th>
                                <th>Caution Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Clear Cache</strong></td>
                                <td>Clear Redis cache (streams, avatars, metadata)</td>
                                <td>🟡 Medium</td>
                            </tr>
                            <tr>
                                <td><strong>Purge Data</strong></td>
                                <td>Delete ALL messages, feedback, and caches</td>
                                <td>🔴 HIGH - Cannot be undone</td>
                            </tr>
                            <tr>
                                <td><strong>Reload Config</strong></td>
                                <td>Reload YAML configuration without restart</td>
                                <td>🟢 Low</td>
                            </tr>
                            <tr>
                                <td><strong>Restart Worker</strong></td>
                                <td>Restart Sentinel message processing worker</td>
                                <td>🟡 Medium</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-danger mt-3">
                    <strong>⚠️ Warning:</strong> Some commands are destructive and cannot be undone. Always backup your data before running purge operations.
                </div>
            </section>

            <section id="maintenance" class="mb-5">
                <h3 class="section-header">Maintenance Tools</h3>
                <p>Optimize performance and maintain system health.</p>
                
                <h4 class="mt-3">Database Maintenance</h4>
                <ul>
                    <li><strong>Vacuum Database:</strong> Reclaim free space and optimize SQLite</li>
                    <li><strong>Analyze Tables:</strong> Update query optimizer statistics</li>
                    <li><strong>Rebuild Indexes:</strong> Recreate indexes for better performance</li>
                    <li><strong>Check Integrity:</strong> Verify database consistency</li>
                </ul>

                <h4 class="mt-3">Automated Maintenance</h4>
                <p>Schedule regular maintenance tasks:</p>
                <ul>
                    <li><strong>Daily:</strong> Cache cleanup, log rotation</li>
                    <li><strong>Weekly:</strong> Database vacuum, index optimization</li>
                    <li><strong>Monthly:</strong> Full integrity check, backup verification</li>
                </ul>

                <h4 class="mt-3">Backup & Restore</h4>
                <ul>
                    <li><strong>Session Backup:</strong> Create encrypted backup of .session file</li>
                    <li><strong>Database Export:</strong> Export messages and config as JSON</li>
                    <li><strong>Full Backup:</strong> Complete system state snapshot</li>
                    <li><strong>Restore:</strong> Restore from previous backup</li>
                </ul>
            </section>

            <section id="diagnostics" class="mb-5">
                <h3 class="section-header">Diagnostics</h3>
                <p>System health checks and troubleshooting tools.</p>
                
                <h4 class="mt-3">Health Checks</h4>
                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">🔌 Connectivity</h5>
                                <p class="card-text">Telegram API, Redis, Database</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">💾 Storage</h5>
                                <p class="card-text">Disk space, database size</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">⚡ Performance</h5>
                                <p class="card-text">CPU, memory, latency</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 class="mt-4">Diagnostic Report</h4>
                <p>Generate comprehensive system report including:</p>
                <ul>
                    <li>System status and health metrics</li>
                    <li>Configuration summary (anonymized)</li>
                    <li>Recent errors and warnings</li>
                    <li>Resource usage statistics</li>
                    <li>Performance benchmarks</li>
                </ul>

                <h4 class="mt-3">Download Diagnostic Bundle</h4>
                <p>Create a ZIP file containing:</p>
                <ul>
                    <li>Diagnostic report (JSON)</li>
                    <li>Recent logs (sanitized)</li>
                    <li>Configuration files (anonymized)</li>
                    <li>Database schema (no data)</li>
                </ul>
                <p>Share with support for troubleshooting.</p>
            </section>

            <section id="manual-troubleshooting" class="mb-5">
                <h2 class="section-header">Troubleshooting</h2>
                <p class="lead">Common issues and solutions for TG Sentinel.</p>

                <h3 class="mt-4">Connection Issues</h3>
                <div class="card mb-3">
                    <div class="card-header">
                        <strong>❌ Cannot connect to Telegram</strong>
                    </div>
                    <div class="card-body">
                        <p><strong>Symptoms:</strong> "Connection failed" or "Timeout" errors</p>
                        <p><strong>Solutions:</strong></p>
                        <ul>
                            <li>Verify API_ID and API_HASH are correct</li>
                            <li>Check internet connection and firewall settings</li>
                            <li>Ensure session file is not corrupted</li>
                            <li>Try re-uploading session or generating new one</li>
                        </ul>
                    </div>
                </div>

                <h3 class="mt-4">Profile Issues</h3>
                <div class="card mb-3">
                    <div class="card-header">
                        <strong>⚠️ No alerts being triggered</strong>
                    </div>
                    <div class="card-body">
                        <p><strong>Symptoms:</strong> Messages arriving but no alerts</p>
                        <p><strong>Solutions:</strong></p>
                        <ul>
                            <li>Check profile is enabled and threshold not too high</li>
                            <li>Verify keywords/examples match incoming content</li>
                            <li>Use Backtest feature to test profile against messages</li>
                            <li>Lower minimum score threshold temporarily</li>
                        </ul>
                    </div>
                </div>

                <h3 class="mt-4">Performance Issues</h3>
                <div class="card mb-3">
                    <div class="card-header">
                        <strong>🐌 Slow message processing</strong>
                    </div>
                    <div class="card-body">
                        <p><strong>Symptoms:</strong> Delays in alerts, high CPU/memory</p>
                        <p><strong>Solutions:</strong></p>
                        <ul>
                            <li>Run database vacuum to optimize storage</li>
                            <li>Clear Redis cache to free memory</li>
                            <li>Reduce number of monitored channels</li>
                            <li>Increase retention cleanup frequency</li>
                            <li>Check for resource limits in Docker</li>
                        </ul>
                    </div>
                </div>

                <h3 class="mt-4">Getting Help</h3>
                <ul>
                    <li><strong>Documentation:</strong> Check this manual and API docs</li>
                    <li><strong>Diagnostic Report:</strong> Generate and review system report</li>
                    <li><strong>Logs:</strong> Check Console logs for error details</li>
                    <li><strong>GitHub Issues:</strong> Report bugs or request features</li>
                    <li><strong>Community:</strong> Join discussions and get support</li>
                </ul>
            </section>
        </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
    const tabButtons = document.querySelectorAll('[data-docs-tab-button]');
    const contentPanes = document.querySelectorAll('[data-docs-content]');
    const navLists = document.querySelectorAll('[data-docs-nav]');
    const navLinks = document.querySelectorAll('.nav-pills .nav-link[href^="#"]');
    const mainContent = document.querySelector('.docs-content');

    let activeTab = null;
    let currentActiveSection = null;
    let updateTimeout = null;

    const updateActiveLink = (id) => {
        if (currentActiveSection === id || !activeTab) {
            return;
        }
        currentActiveSection = id;
        document.querySelectorAll(`.docs-nav-list[data-docs-nav="${activeTab}"] .nav-link`).forEach(link => {
            link.classList.remove('active');
            link.removeAttribute('aria-current');
            if (link.getAttribute('href') === `#${id}`) {
                link.classList.add('active');
                link.setAttribute('aria-current', 'page');
            }
        });
    };

    const observer = new IntersectionObserver((entries) => {
        if (updateTimeout) {
            clearTimeout(updateTimeout);
        }
        updateTimeout = setTimeout(() => {
            let mostVisible = null;
            let maxRatio = 0;
            entries.forEach(entry => {
                if (entry.isIntersecting && entry.intersectionRatio > maxRatio) {
                    maxRatio = entry.intersectionRatio;
                    mostVisible = entry.target;
                }
            });
            if (mostVisible) {
                updateActiveLink(mostVisible.getAttribute('id'));
            }
        }, 100);
    }, {
        threshold: [0, 0.25, 0.5, 0.75, 1],
        rootMargin: '-20% 0px -20% 0px'
    });

    const observeSectionsForActiveTab = () => {
        observer.disconnect();
        if (!activeTab) {
            return;
        }
        const activePane = document.querySelector(`[data-docs-content="${activeTab}"]`);
        if (activePane) {
            activePane.querySelectorAll('section[id]').forEach(section => observer.observe(section));
        }
    };

    const resetNavLinks = () => {
        document.querySelectorAll('.nav-pills .nav-link').forEach(link => {
            link.classList.remove('active');
            link.removeAttribute('aria-current');
        });
    };

    const activateDocsTab = (tabName) => {
        if (activeTab === tabName) {
            return;
        }
        activeTab = tabName;
        tabButtons.forEach(btn => {
            const isActive = btn.dataset.docsTabButton === tabName;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-selected', String(isActive));
        });
        contentPanes.forEach(pane => {
            pane.classList.toggle('active', pane.dataset.docsContent === tabName);
        });
        navLists.forEach(list => {
            list.classList.toggle('active', list.dataset.docsNav === tabName);
        });
        currentActiveSection = null;
        observeSectionsForActiveTab();
        resetNavLinks();
        const firstNavLink = document.querySelector(`.docs-nav-list[data-docs-nav="${tabName}"] .nav-link`);
        if (firstNavLink) {
            firstNavLink.classList.add('active');
            firstNavLink.setAttribute('aria-current', 'page');
        }
        // Scroll to top of page when switching tabs
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.docsTabButton;
            if (tabName) {
                activateDocsTab(tabName);
            }
        });
    });

    // Smooth scrolling limited to the active tab's navigation links
    navLinks.forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const parentList = this.closest('[data-docs-nav]');
            if (!parentList || parentList.dataset.docsNav !== activeTab) {
                return;
            }
            if (e.detail !== 0) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    // Calculate offset from top of page
                    const targetRect = target.getBoundingClientRect();
                    const navbarHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--navbar-height')) || 76;
                    const scrollOffset = window.pageYOffset + targetRect.top - navbarHeight - 20;
                    window.scrollTo({ top: scrollOffset, behavior: 'smooth' });
                    resetNavLinks();
                    this.classList.add('active');
                    this.setAttribute('aria-current', 'page');
                }
            }
        });
    });

    // Hash-based routing: determine which tab to show based on URL hash
    const handleHashChange = () => {
        const hash = window.location.hash.slice(1); // Remove the '#'
        if (!hash) {
            activateDocsTab('sentinel');
            return;
        }

        // Map of section IDs to their parent tabs
        const sectionToTab = {
            // User Manual sections
            'manual-overview': 'manual',
            'manual-getting-started': 'manual',
            'manual-profiles': 'manual',
            'alert-profiles': 'manual',
            'interest-profiles': 'manual',
            'detection-settings': 'manual',
            'profile-scope': 'manual',
            'digest-api': 'manual',
            'alerts-api': 'manual',
            'configuration': 'manual',
            'telegram-config': 'manual',
            'alerts-config': 'manual',
            'advanced-config': 'manual',
            'channels-api': 'manual',
            'users-api': 'manual',
            'system-config': 'manual',
            'analytics': 'manual',
            'performance-metrics': 'manual',
            'resource-metrics': 'manual',
            'keyword-heatmap': 'manual',
            'channel-impact': 'manual',
            'developer': 'manual',
            'integration-settings': 'manual',
            'webhooks-api': 'manual',
            'integration-console': 'manual',
            'console': 'manual',
            'console-logs': 'manual',
            'console-commands': 'manual',
            'maintenance': 'manual',
            'diagnostics': 'manual',
            'manual-troubleshooting': 'manual',
            // Sentinel API sections
            'sentinel-overview': 'sentinel',
            'sentinel-health': 'sentinel',
            'sentinel-session': 'sentinel',
            'sentinel-telegram': 'sentinel',
            'sentinel-alerts': 'sentinel',
            'sentinel-profiles': 'sentinel',
            'sentinel-metrics': 'sentinel',
            // UI API sections (if they exist, otherwise default to 'ui' tab)
        };

        const targetTab = sectionToTab[hash] || 'sentinel';
        activateDocsTab(targetTab);

        // Scroll to the target section after a brief delay to allow tab switch
        setTimeout(() => {
            const target = document.getElementById(hash);
            if (target) {
                const navbarHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--navbar-height')) || 76;
                const targetRect = target.getBoundingClientRect();
                const scrollOffset = window.pageYOffset + targetRect.top - navbarHeight - 20;
                window.scrollTo({ top: scrollOffset, behavior: 'smooth' });
            }
        }, 100);
    };

    // Handle hash changes (back/forward navigation)
    window.addEventListener('hashchange', handleHashChange);

    // Handle initial page load with hash
    handleHashChange();

    const cleanup = () => {
        if (updateTimeout) {
            clearTimeout(updateTimeout);
        }
        observer.disconnect();
    };

    window.addEventListener('beforeunload', cleanup);
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            cleanup();
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('pre code').forEach(block => {
            hljs.highlightElement(block);
        });
    });
</script>
<!-- Highlight.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}

{# Alert Profile Form - Extracted from profiles.html #}
{# This form includes all fields for Alert Profile configuration #}

<form id="alert-profile-form" class="d-grid gap-3" novalidate>
    <input type="hidden" id="alert-profile-id" value="">
    
    <div class="alert alert-info" role="alert">
        <strong>Select a profile</strong> from the list or create a new one to configure keyword-based detection.
    </div>
    
    <!-- Basic Info -->
    <div class="row">
        <div class="col-md-4 d-none">
            <label class="form-label" for="alert-profile-id-display">Profile ID</label>
            <input class="form-control bg-light" id="alert-profile-id-display" type="text" placeholder="Auto-generated" readonly>
            <small class="form-text text-muted">Auto-assigned integer ID (1000-1999)</small>
        </div>
        <div class="col-md-4">
            <label class="form-label" for="alert-name">Profile Name <span class="text-danger">*</span></label>
            <input class="form-control" id="alert-name" name="name" type="text" placeholder="e.g., Security Alerts" required>
        </div>
        <div class="col-md-4">
            <label class="form-label" for="alert-enabled">Status</label>
            <select class="form-select" id="alert-enabled" name="enabled">
                <option value="true" selected>Enabled</option>
                <option value="false">Disabled</option>
            </select>
        </div>
    </div>
    
    <div>
        <label class="form-label" for="alert-description">Description</label>
        <input class="form-control" id="alert-description" name="description" type="text" placeholder="Brief description">
    </div>
    
    <!-- Keywords Section -->
    <div class="border-top pt-3">
        <h3 class="h6 mb-3">Keyword Detection</h3>
        
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label" for="alert-critical-keywords">Critical Keywords</label>
                <textarea class="form-control font-monospace" id="alert-critical-keywords" name="critical_keywords" rows="3" placeholder="exploit, breach, hack"></textarea>
                <small class="text-muted">Comma-separated. Highest priority.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-security-keywords">Security Keywords</label>
                <textarea class="form-control font-monospace" id="alert-security-keywords" name="security_keywords" rows="3" placeholder="vulnerability, attack, malicious"></textarea>
                <small class="text-muted">Security-related terms.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-urgency-keywords">Urgency Keywords</label>
                <textarea class="form-control font-monospace" id="alert-urgency-keywords" name="urgency_keywords" rows="3" placeholder="urgent, asap, critical"></textarea>
                <small class="text-muted">Time-sensitive indicators.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-financial-keywords">Financial Keywords</label>
                <textarea class="form-control font-monospace" id="alert-financial-keywords" name="financial_keywords" rows="3" placeholder="price, market, trading"></textarea>
                <small class="text-muted">Market and financial terms.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-technical-keywords">Technical Keywords</label>
                <textarea class="form-control font-monospace" id="alert-technical-keywords" name="technical_keywords" rows="3" placeholder="update, upgrade, release"></textarea>
                <small class="text-muted">Development and tech terms.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-project-keywords">Project Keywords</label>
                <textarea class="form-control font-monospace" id="alert-project-keywords" name="project_keywords" rows="3" placeholder="marketing, alert, governance"></textarea>
                <small class="text-muted">Project-specific terms.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-community-keywords">Community Keywords</label>
                <textarea class="form-control font-monospace" id="alert-community-keywords" name="community_keywords" rows="3" placeholder="announcement, airdrop, vote"></textarea>
                <small class="text-muted">Community engagement terms.</small>
            </div>
            <div class="col-md-6">
                <label class="form-label" for="alert-general-keywords">General Keywords</label>
                <textarea class="form-control font-monospace" id="alert-general-keywords" name="general_keywords" rows="3" placeholder="news, update, important"></textarea>
                <small class="text-muted">General interest terms.</small>
            </div>
        </div>
    </div>
    
    <!-- Detection Settings -->
    <div class="border-top pt-3">
        <h3 class="h6 mb-3">Detection Settings</h3>
        
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label" for="alert-min-score">Minimum Score</label>
                <input class="form-control" id="alert-min-score" name="min_score" type="number" min="0" max="10" step="0.1" value="1.0">
                <small class="text-muted">Threshold for alerts (0-10)</small>
            </div>
            <div class="col-md-4">
                <label class="form-label" for="alert-vip-senders">VIP Senders</label>
                <input class="form-control font-monospace" id="alert-vip-senders" name="vip_senders" type="text" placeholder="@username1, @username2">
                <small class="text-muted">Always alert from these</small>
            </div>
            <div class="col-md-4">
                <label class="form-label" for="alert-excluded-users">Excluded Users</label>
                <input class="form-control font-monospace" id="alert-excluded-users" name="excluded_users" type="text" placeholder="@spammer, @bot">
                <small class="text-muted">Never alert from these</small>
            </div>
        </div>
        
        <div class="row g-3 mt-2">
            <div class="col-md-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="alert-detect-questions" name="detect_questions">
                    <label class="form-check-label" for="alert-detect-questions">Detect Questions</label>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="alert-detect-mentions" name="detect_mentions">
                    <label class="form-check-label" for="alert-detect-mentions">Detect Mentions</label>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="alert-detect-links" name="detect_links">
                    <label class="form-check-label" for="alert-detect-links">Detect Links</label>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="alert-require-forwarded" name="require_forwarded">
                    <label class="form-check-label" for="alert-require-forwarded">Only Forwards</label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scope Restriction (Channels & Users) -->
    <div class="border-top pt-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 class="h6 mb-0">Apply Profile To</h3>
            <button type="button" class="btn btn-primary btn-sm" id="btn-select-entities-alert" data-bs-toggle="modal" data-bs-target="#selectEntitiesModal">
                <span aria-hidden="true">+</span> ADD
            </button>
        </div>
        <div id="selected-entities-alert" class="border rounded p-3 bg-dark entity-selector-container">
            <div class="text-muted small" id="entities-placeholder-alert">No channels or users selected.</div>
            <div id="entities-badges-alert" class="d-flex flex-wrap gap-2"></div>
        </div>
        <small class="text-muted">Select specific channels/users or leave empty to apply to all monitored entities configured in the settings section.</small>
    </div>
    
    <!-- Digest Configuration for Alert Profiles -->
    <div class="border rounded p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h6 mb-0">
                <svg width="14" height="14" fill="currentColor" class="bi bi-envelope me-1" viewBox="0 0 16 16">
                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
                </svg>
                Digest Schedules
            </h3>
            <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="collapse" data-bs-target="#alert-digest-help" aria-label="Show digest help information">
                <svg width="14" height="14" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                </svg>
            </button>
        </div>
        
        <div class="collapse mb-3" id="alert-digest-help">
            <div class="alert alert-info small mb-0">
                <p class="mb-1"><strong>What are digest schedules?</strong></p>
                <p class="mb-1">Instead of instant alerts for every message, digest schedules batch messages and send summaries at regular intervals.</p>
                <p class="mb-0 mt-2"><em>Configure up to 3 schedules for this channel's alert profile.</em></p>
            </div>
        </div>
        
        {# Render 3 schedule cards for Alert Profiles #}
        {% for schedule_num in range(1, 4) %}
        <div class="card mb-3">
            <div class="card-header py-2">
                {% if schedule_num > 1 %}
                <button class="btn btn-link p-0 text-decoration-none text-white d-flex align-items-center gap-2 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#alert-schedule-{{ schedule_num }}-body" aria-expanded="false">
                    <svg width="14" height="14" fill="currentColor" class="bi bi-chevron-right schedule-chevron" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                    <strong>Schedule {{ schedule_num }}</strong> <span class="badge bg-dark">Optional</span>
                </button>
                {% else %}
                <strong>Schedule {{ schedule_num }}</strong>
                {% endif %}
            </div>
            <div class="card-body{% if schedule_num > 1 %} collapse{% endif %}" id="alert-schedule-{{ schedule_num }}-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label" for="alert-digest-schedule-{{ schedule_num }}-type">Schedule Type</label>
                        <select class="form-select form-select-sm alert-digest-schedule-type" id="alert-digest-schedule-{{ schedule_num }}-type" name="alert_digest_schedule_{{ schedule_num }}_type">
                            <option value="">{% if schedule_num == 1 %}None (Instant Alerts){% else %}None{% endif %}</option>
                            <option value="hourly">‚è∞ Hourly</option>
                            <option value="every_4h">üïì Every 4 Hours</option>
                            <option value="every_6h">üïï Every 6 Hours</option>
                            <option value="every_12h">üïõ Every 12 Hours</option>
                            <option value="daily">üìÖ Daily</option>
                            <option value="weekly">üìä Weekly</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" for="alert-digest-schedule-{{ schedule_num }}-top-n">Top N Messages</label>
                        <input type="number" class="form-control form-control-sm" id="alert-digest-schedule-{{ schedule_num }}-top-n" name="alert_digest_schedule_{{ schedule_num }}_top_n" min="1" max="100" value="{{ 10 * schedule_num }}" placeholder="{{ 10 * schedule_num }}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" for="alert-digest-schedule-{{ schedule_num }}-min-score">Min Score</label>
                        <input type="number" class="form-control form-control-sm" id="alert-digest-schedule-{{ schedule_num }}-min-score" name="alert_digest_schedule_{{ schedule_num }}_min_score" min="0" max="10" step="0.1" value="{{ 6.0 - schedule_num }}" placeholder="{{ 6.0 - schedule_num }}">
                    </div>
                    <div class="col-md-6 alert-digest-daily-settings d-none" id="alert-digest-schedule-{{ schedule_num }}-daily-settings">
                        <label class="form-label" for="alert-digest-schedule-{{ schedule_num }}-daily-hour">Daily Hour (UTC)</label>
                        <input type="number" class="form-control form-control-sm" id="alert-digest-schedule-{{ schedule_num }}-daily-hour" name="alert_digest_schedule_{{ schedule_num }}_daily_hour" min="0" max="23" value="8" placeholder="8">
                    </div>
                    <div class="col-md-6 alert-digest-weekly-settings d-none" id="alert-digest-schedule-{{ schedule_num }}-weekly-settings">
                        <label class="form-label" for="alert-digest-schedule-{{ schedule_num }}-weekly-day">Weekly Day</label>
                        <select class="form-select form-select-sm" id="alert-digest-schedule-{{ schedule_num }}-weekly-day" name="alert_digest_schedule_{{ schedule_num }}_weekly_day">
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>
                    <div class="col-md-6 alert-digest-weekly-settings d-none" id="alert-digest-schedule-{{ schedule_num }}-weekly-hour-settings">
                        <label class="form-label" for="alert-digest-schedule-{{ schedule_num }}-weekly-hour">Weekly Hour (UTC)</label>
                        <input type="number" class="form-control form-control-sm" id="alert-digest-schedule-{{ schedule_num }}-weekly-hour" name="alert_digest_schedule_{{ schedule_num }}_weekly_hour" min="0" max="23" value="8" placeholder="8">
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        
        <!-- Delivery Settings for Alert Profiles -->
        <div class="card bg-secondary">
            <div class="card-header py-2">
                <strong>Delivery Settings</strong>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label" for="alert-digest-mode">Delivery Mode</label>
                        <select class="form-select form-select-sm" id="alert-digest-mode" name="alert_digest_mode">
                            <option value="dm">üí¨ DM Only (Saved Messages)</option>
                            <option value="channel">üì¢ Channel Only</option>
                            <option value="both">üîÑ Both DM & Channel</option>
                        </select>
                        <small class="form-text">Where to send digests</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="alert-digest-target-channel">Target Channel (for channel/both mode)</label>
                        <input type="text" class="form-control form-control-sm" id="alert-digest-target-channel" name="alert_digest_target_channel" placeholder="@my_alerts_channel">
                        <small class="form-text">Channel username or ID</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="d-flex gap-3 border-top pt-3">
        <button class="btn btn-primary" type="submit" id="btn-save-alert-profile">
            <span id="alert-save-btn-text">Save Profile</span>
        </button>
        <button class="btn btn-outline-primary" type="button" id="btn-backtest-alert-profile">
            <svg width="16" height="16" fill="currentColor" class="bi bi-speedometer me-1" viewBox="0 0 16 16">
                <path d="M8 2a.5.5 0 0 1 .5.5V4a.5.5 0 0 1-1 0V2.5A.5.5 0 0 1 8 2zM3.732 3.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 8a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 8zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 7.31A.91.91 0 1 0 8.85 8.569l3.434-4.297a.389.389 0 0 0-.029-.518z"/>
                <path fill-rule="evenodd" d="M6.664 15.889A8 8 0 1 1 9.336.11a8 8 0 0 1-2.672 15.78zm-4.665-4.283A11.945 11.945 0 0 1 8 10c2.186 0 4.236.585 6.001 1.606a7 7 0 1 0-12.002 0z"/>
            </svg>
            Backtest
        </button>
        <button class="btn btn-outline-secondary" type="button" id="btn-reset-alert-profile">Clear</button>
        <button class="btn btn-outline-danger d-none" type="button" id="btn-delete-alert-profile">Delete</button>
    </div>
</form>
